<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="在不同的操作系统和架构编译 Go 应用 # 在软件开发中，重要的是要考虑你想为之编译二进制的操作系统和底层处理器架构。因为在不同的操作系统/架构平台上运行一个二进制文件通常很慢或不可能，所以通常的做法是为许多不同的平台编译你最终的二进制文件，以最大化你的程序的受众。然而，这通常是很困难的，当你开发软件的平台和你想要部署的平台不是同一个的时候。例如，在过去，在 Windows 上开发一个程序并将其部署到 Linux 或 macOS 机器上，需要为每一个你想要的二进制文件的环境设置构建机器。你还需要保持你的工具同步，此外还有其他考虑因素，这些因素会增加成本，使协作测试和分布式更加困难。
Go 通过在go build工具中直接建立对多平台的支持，以及 Go 工具链的其他部分解决了这个问题。通过使用环境变量和构建标签，你可以控制你最终的二进制文件是为哪个操作系统和架构构建的，此外还可以把一个工作流程放在一起，在不改变你的代码库的情况下快速切换对平台依赖的代码。
在本教程中，你将把一个将strings连接成文件路径的示例应用程序放在一起，创建并有选择地包括与平台有关的片段，并在你自己的系统上为多个操作系统和系统架构构建二进制文件，向你展示如何使用 Go 编程语言的这一强大能力。
前期准备 # 为了跟随本文的例子，你将需要：
按照如何安装 Go 和设置本地程序环境设置的 Go 的 workspace GOOS和GOARCH可能支持的平台 # 在展示如何控制构建过程为不同的平台构建二进制文件之前，让我们先了解一下 Go 能够为哪些类型的平台进行构建，以及 Go 如何使用环境变量GOOS和GOARCH关联这些平台。
Go 工具有一个命令，可以打印出 Go 可以构建的平台的列表。这个列表会随着每一个新的 Go 版本而改变，所以这里讨论的组合在另一个版本的 Go 中可能不一样。当下写这个教程的时候，Go release 版本是 1.13.
为了找到适用的平台，执行如下命令：
go tool dist list 你将会收到如下相似的输出：
Output aix/ppc64 freebsd/amd64 linux/mipsle openbsd/386 android/386 freebsd/arm linux/ppc64 openbsd/amd64 android/amd64 illumos/amd64 linux/ppc64le openbsd/arm android/arm js/wasm linux/s390x openbsd/arm64 android/arm64 linux/386 nacl/386 plan9/386 darwin/386 linux/amd64 nacl/amd64p32 plan9/amd64 darwin/amd64 linux/arm nacl/arm plan9/arm darwin/arm linux/arm64 netbsd/386 solaris/amd64 darwin/arm64 linux/mips netbsd/amd64 windows/386 dragonfly/amd64 linux/mips64 netbsd/arm windows/amd64 freebsd/386 linux/mips64le netbsd/arm64 windows/arm 输出是一些以/分割的键值对。键值对的第一个部分，在/之前的是操作系统。在 Go 里面，这些操作系统会是环境变量GOOS的值，发音像“goose”，代表Go Operation System。第二部分，在/之后的，是架构。如前所述，这些都是环境变量GOARCH可能的值。这个发音&#34;gore-ch&#34;，代表Go Architecture。"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="在不同的操作系统和架构编译 Go 应用 # 在软件开发中，重要的是要考虑你想为之编译二进制的操作系统和底层处理器架构。因为在不同的操作系统/架构平台上运行一个二进制文件通常很慢或不可能，所以通常的做法是为许多不同的平台编译你最终的二进制文件，以最大化你的程序的受众。然而，这通常是很困难的，当你开发软件的平台和你想要部署的平台不是同一个的时候。例如，在过去，在 Windows 上开发一个程序并将其部署到 Linux 或 macOS 机器上，需要为每一个你想要的二进制文件的环境设置构建机器。你还需要保持你的工具同步，此外还有其他考虑因素，这些因素会增加成本，使协作测试和分布式更加困难。
Go 通过在go build工具中直接建立对多平台的支持，以及 Go 工具链的其他部分解决了这个问题。通过使用环境变量和构建标签，你可以控制你最终的二进制文件是为哪个操作系统和架构构建的，此外还可以把一个工作流程放在一起，在不改变你的代码库的情况下快速切换对平台依赖的代码。
在本教程中，你将把一个将strings连接成文件路径的示例应用程序放在一起，创建并有选择地包括与平台有关的片段，并在你自己的系统上为多个操作系统和系统架构构建二进制文件，向你展示如何使用 Go 编程语言的这一强大能力。
前期准备 # 为了跟随本文的例子，你将需要：
按照如何安装 Go 和设置本地程序环境设置的 Go 的 workspace GOOS和GOARCH可能支持的平台 # 在展示如何控制构建过程为不同的平台构建二进制文件之前，让我们先了解一下 Go 能够为哪些类型的平台进行构建，以及 Go 如何使用环境变量GOOS和GOARCH关联这些平台。
Go 工具有一个命令，可以打印出 Go 可以构建的平台的列表。这个列表会随着每一个新的 Go 版本而改变，所以这里讨论的组合在另一个版本的 Go 中可能不一样。当下写这个教程的时候，Go release 版本是 1.13.
为了找到适用的平台，执行如下命令：
go tool dist list 你将会收到如下相似的输出：
Output aix/ppc64 freebsd/amd64 linux/mipsle openbsd/386 android/386 freebsd/arm linux/ppc64 openbsd/amd64 android/amd64 illumos/amd64 linux/ppc64le openbsd/arm android/arm js/wasm linux/s390x openbsd/arm64 android/arm64 linux/386 nacl/386 plan9/386 darwin/386 linux/amd64 nacl/amd64p32 plan9/amd64 darwin/amd64 linux/arm nacl/arm plan9/arm darwin/arm linux/arm64 netbsd/386 solaris/amd64 darwin/arm64 linux/mips netbsd/amd64 windows/386 dragonfly/amd64 linux/mips64 netbsd/arm windows/amd64 freebsd/386 linux/mips64le netbsd/arm64 windows/arm 输出是一些以/分割的键值对。键值对的第一个部分，在/之前的是操作系统。在 Go 里面，这些操作系统会是环境变量GOOS的值，发音像“goose”，代表Go Operation System。第二部分，在/之后的，是架构。如前所述，这些都是环境变量GOARCH可能的值。这个发音&#34;gore-ch&#34;，代表Go Architecture。"><meta property="og:type" content="article"><meta property="og:url" content="https://gocn.github.io/How-To-Code-in-Go/docs/38-Building_Go_Applications_for_Different_Operating_Systems_and_Architectures/"><meta property="article:section" content="docs"><title>38 Building Go Applications for Different Operating Systems and Architectures | How To Code in Go</title><link rel=manifest href=/How-To-Code-in-Go/manifest.json><link rel=icon href=/How-To-Code-in-Go/favicon.png type=image/x-icon><link rel=stylesheet href=/How-To-Code-in-Go/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/How-To-Code-in-Go/flexsearch.min.js></script>
<script defer src=/How-To-Code-in-Go/zh.search.min.2ccdafc211784f64f63652981924d269b4ff643413814bfc0d5743573b76ade7.js integrity="sha256-LM2vwhF4T2T2NlKYGSTSabT/ZDQTgUv8DVdDVzt2rec=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/How-To-Code-in-Go/><span>How To Code in Go</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><p><strong>开始学习</strong></p><ul><li><a href=/How-To-Code-in-Go/docs/01-How_To_Install_Go_and_Set_Up_a_Local-Programming_Environment_on_Ubuntu_18.04_DigitalOcean/>1. 如何在 Ubuntu 18.04 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/02-How_To_Install_Go_and_Set_Up_a_Local_Programming_Environment_on_macOS_DigitalOcean/>2. 如何在 macOS 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/03-How_To_Install_Go_and_Set_Up_a_Local_Programming_Environment_on_Windows_10_DigitalOcean/>3. 如何在 Windows 10 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/04-How_To_Write_Your_First_Program_in_Go_DigitalOcean/>4. 如何用 Go 编写你的第一个程序</a></li><li><a href=/How-To-Code-in-Go/docs/05-Understanding_the_GOPATH/>5. 理解 GOPATH</a></li><li><a href=/How-To-Code-in-Go/docs/06-How_To_Write_Comments_in_Go/>6. 如何在 Go 中写注释</a></li><li><a href=/How-To-Code-in-Go/docs/07-Understanding_Data_Types_in_Go/>7. 理解 Go 的数据类型</a></li><li><a href=/How-To-Code-in-Go/docs/08-An_Introduction_to_Working_with_Strings_in_Go/>8. Go 中处理字符串的介绍</a></li><li><a href=/How-To-Code-in-Go/docs/09-How_To_Format_Strings_in_Go/>9. 如何在 Go 中格式化字符串</a></li><li><a href=/How-To-Code-in-Go/docs/10-An_Introduction_to_the_Strings_Package_in_Go/>10. 介绍 Go 中的 Strings 包</a></li><li><a href=/How-To-Code-in-Go/docs/11-How_To_Use_Variables_and_Constants_in_Go/>11. 如何在 Go 中使用变量和常量</a></li><li><a href=/How-To-Code-in-Go/docs/12-How_To_Convert_Data_Types_in_Go/>12. 如何在 Go 中转换数据类型</a></li><li><a href=/How-To-Code-in-Go/docs/13-How_To_Do_Math_in_Go_with_Operators/>13. 如何用运算符在 Go 中做数学计算</a></li><li><a href=/How-To-Code-in-Go/docs/14-Understanding_Boolean_Logic_in_Go/>14. 理解 Go 中的布尔逻辑</a></li><li><a href=/How-To-Code-in-Go/docs/15-Understanding_Maps_in_Go/>15. 理解 Go 中的 Map</a></li><li><a href=/How-To-Code-in-Go/docs/16-Understanding_Arrays_and_Slices_in_Go/>16. 理解 Go 中的数组和切片</a></li><li><a href=/How-To-Code-in-Go/docs/17-Handling_Errors_in_Go_DigitalOcean/>17. 在 Go 中处理错误</a></li><li><a href=/How-To-Code-in-Go/docs/18-Creating_Custom_Errors_in_Go_DigitalOcean/>18. 在 Go 中创建自定义错误</a></li><li><a href=/How-To-Code-in-Go/docs/19-Handling_Panics_in_Go-_DigitalOcean/>19 在 Go 中处理恐慌</a></li><li><a href=/How-To-Code-in-Go/docs/20-Importing_Packages_in_Go_DigitalOcean/>20. 在 Go 中导入包</a></li><li><a href=/How-To-Code-in-Go/docs/21-How_To_Write_Packages_in_Go/>21. 如何在 Go 中编写包</a></li><li><a href=/How-To-Code-in-Go/docs/22-Understanding_Package_Visibility_in_Go/>22. 理解 Go 中包的可见性</a></li><li><a href=/How-To-Code-in-Go/docs/23-How_To_Write_Conditional_Statements_in_Go/>23. 如何在 Go 中编写条件语句</a></li><li><a href=/How-To-Code-in-Go/docs/24-How_To_Write_Switch_Statements_in_Go/>24. 如何在 Go 中编写 Switch 语句</a></li><li><a href=/How-To-Code-in-Go/docs/25-How_To_Construct_For_Loops_in_Go/>25. 如何在 Go 中构造 for 循环</a></li><li><a href=/How-To-Code-in-Go/docs/26-Using_Break_and_Continue_Statements_When_Working_with_Loops_in_Go/>26. 在循环中使用 Break 和 Continue</a></li><li><a href=/How-To-Code-in-Go/docs/27-How_To_Define_and_Call_Functions_in_Go/>27. 如何在 Go 中定义并调用函数</a></li><li><a href=/How-To-Code-in-Go/docs/28-How_To_Use_Variadic_Functions_in_Go/>28. 如何在 Go 中使用可变参数函数</a></li><li><a href=/How-To-Code-in-Go/docs/29-Understanding_defer_in_Go/>29. 理解 Go 中的 defer</a></li><li><a href=/How-To-Code-in-Go/docs/30-Understanding_init_in_Go/>30. 理解 Go 中的 init</a></li><li><a href=/How-To-Code-in-Go/docs/31-Customizing_Go_Binaries_with_Build_Tags/>31. 用构建标签定制 Go 二进制文件</a></li><li><a href=/How-To-Code-in-Go/docs/32-Understanding_Pointers_in_Go/>32. 理解 Go 中的指针</a></li><li><a href=/How-To-Code-in-Go/docs/33-Defining_Structs_in_Go/>33. 在 Go 中定义结构体</a></li><li><a href=/How-To-Code-in-Go/docs/34-Defining_Methods_in_Go/>34. 在 Go 中定义方法</a></li><li><a href=/How-To-Code-in-Go/docs/35-How_To_Build_and_Install_Go_Programs/>35. 如何构建和安装 Go 程序</a></li><li><a href=/How-To-Code-in-Go/docs/36-How_To_Use_Struct_Tags_in_Go/>36. 如何在 Go 中使用结构体标签</a></li><li><a href=/How-To-Code-in-Go/docs/37-How_To_Use_Interfaces_in_Go/>37. 如何在 Go 使用 interface</a></li><li><a href=/How-To-Code-in-Go/docs/38-Building_Go_Applications_for_Different_Operating_Systems_and_Architectures/ class=active>38. 在不同的操作系统和架构编译 Go 应用</a></li><li><a href=/How-To-Code-in-Go/docs/39-Using_ldflags_to_Set_Version_Information_for_Go_Applications/>39. 用 ldflags 设置 Go 应用程序的版本信息</a></li><li><a href=/How-To-Code-in-Go/docs/40-How_To_Use_the_Flag_Package_in_Go/>40. 在 Go 里面如何使用 Flag 包</a></li><li><a href=/How-To-Code-in-Go/docs/41-How_to_Use_Go_Modules/>41. 如何使用 Go 模块</a></li><li><a href=/How-To-Code-in-Go/docs/42-How_to_Distribute_Go_Modules/>42. 如何分发 Go 模块</a></li><li><a href=/How-To-Code-in-Go/docs/43-How_to_Use_a_Private_Go_Module_in_Your_Own_Project/>43. 如何在自己的项目中使用私有的Go模块</a></li></ul></li><li><p><strong>附录：资源</strong></p></li><li><p><a href=https://github.com/gocn/How-To-Code-in-Go><strong>Fork on Github</strong></a></p></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/How-To-Code-in-Go/svg/menu.svg class=book-icon alt=Menu></label>
<strong>38 Building Go Applications for Different Operating Systems and Architectures</strong>
<label for=toc-control><img src=/How-To-Code-in-Go/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#前期准备>前期准备</a></li><li><a href=#goos和goarch可能支持的平台><code>GOOS</code>和<code>GOARCH</code>可能支持的平台</a></li><li><a href=#用filepathjoin编写一个平台依赖的应用程序>用<code>filepath.Join</code>编写一个平台依赖的应用程序</a></li><li><a href=#实现一个平台特定函数>实现一个平台特定函数</a></li><li><a href=#使用goos或goarch构建标签>使用<code>GOOS</code>或<code>GOARCH</code>构建标签</a></li><li><a href=#使用你本地goos和goarch环境变量>使用你本地<code>GOOS</code>和<code>GOARCH</code>环境变量</a></li><li><a href=#使用goos和goarch文件名后缀>使用<code>GOOS</code>和<code>GOARCH</code>文件名后缀</a></li><li><a href=#总结>总结</a></li></ul></nav></aside></header><article class=markdown><h1 id=在不同的操作系统和架构编译-go-应用>在不同的操作系统和架构编译 Go 应用
<a class=anchor href=#%e5%9c%a8%e4%b8%8d%e5%90%8c%e7%9a%84%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e5%92%8c%e6%9e%b6%e6%9e%84%e7%bc%96%e8%af%91-go-%e5%ba%94%e7%94%a8>#</a></h1><p>在软件开发中，重要的是要考虑你想为之编译二进制的<a href=https://en.wikipedia.org/wiki/Operating_system>操作系统</a>和底层处理器<a href=https://en.wikipedia.org/wiki/Microarchitecture>架构</a>。因为在不同的操作系统/架构平台上运行一个二进制文件通常很慢或不可能，所以通常的做法是为许多不同的平台编译你最终的二进制文件，以最大化你的程序的受众。然而，这通常是很困难的，当你开发软件的平台和你想要部署的平台不是同一个的时候。例如，在过去，在 Windows 上开发一个程序并将其部署到 Linux 或 macOS 机器上，需要为每一个你想要的二进制文件的环境设置构建机器。你还需要保持你的工具同步，此外还有其他考虑因素，这些因素会增加成本，使协作测试和分布式更加困难。</p><p>Go 通过在<code>go build</code>工具中直接建立对多平台的支持，以及 Go 工具链的其他部分解决了这个问题。通过使用<a href=https://www.digitalocean.com/community/tutorials/how-to-read-and-set-environmental-and-shell-variables-on-a-linux-vps>环境变量</a>和<a href=/How-To-Code-in-Go/docs/31-Customizing_Go_Binaries_with_Build_Tags/>构建标签</a>，你可以控制你最终的二进制文件是为哪个操作系统和架构构建的，此外还可以把一个工作流程放在一起，在不改变你的代码库的情况下快速切换对平台依赖的代码。</p><p>在本教程中，你将把一个将<a href=/How-To-Code-in-Go/docs/08-An_Introduction_to_Working_with_Strings_in_Go/>strings</a>连接成文件路径的示例应用程序放在一起，创建并有选择地包括与平台有关的片段，并在你自己的系统上为多个操作系统和系统架构构建二进制文件，向你展示如何使用 Go 编程语言的这一强大能力。</p><h2 id=前期准备>前期准备
<a class=anchor href=#%e5%89%8d%e6%9c%9f%e5%87%86%e5%a4%87>#</a></h2><p>为了跟随本文的例子，你将需要：</p><ul><li>按照<a href=/How-To-Code-in-Go/docs/01-How_To_Install_Go_and_Set_Up_a_Local-Programming_Environment_on_Ubuntu_18.04_DigitalOcean/>如何安装 Go 和设置本地程序环境</a>设置的 Go 的 workspace</li></ul><h2 id=goos和goarch可能支持的平台><code>GOOS</code>和<code>GOARCH</code>可能支持的平台
<a class=anchor href=#goos%e5%92%8cgoarch%e5%8f%af%e8%83%bd%e6%94%af%e6%8c%81%e7%9a%84%e5%b9%b3%e5%8f%b0>#</a></h2><p>在展示如何控制构建过程为不同的平台构建二进制文件之前，让我们先了解一下 Go 能够为哪些类型的平台进行构建，以及 Go 如何使用环境变量<code>GOOS</code>和<code>GOARCH</code>关联这些平台。</p><p>Go 工具有一个命令，可以打印出 Go 可以构建的平台的列表。这个列表会随着每一个新的 Go 版本而改变，所以这里讨论的组合在另一个版本的 Go 中可能不一样。当下写这个教程的时候，Go release 版本是 <a href=https://golang.org/doc/go1.13><code>1.13</code></a>.</p><p>为了找到适用的平台，执行如下命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go tool dist list
</span></span></code></pre></div><p>你将会收到如下相似的输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>aix/ppc64        freebsd/amd64   linux/mipsle   openbsd/386
</span></span><span style=display:flex><span>android/386      freebsd/arm     linux/ppc64    openbsd/amd64
</span></span><span style=display:flex><span>android/amd64    illumos/amd64   linux/ppc64le  openbsd/arm
</span></span><span style=display:flex><span>android/arm      js/wasm         linux/s390x    openbsd/arm64
</span></span><span style=display:flex><span>android/arm64    linux/386       nacl/386       plan9/386
</span></span><span style=display:flex><span>darwin/386       linux/amd64     nacl/amd64p32  plan9/amd64
</span></span><span style=display:flex><span>darwin/amd64     linux/arm       nacl/arm       plan9/arm
</span></span><span style=display:flex><span>darwin/arm       linux/arm64     netbsd/386     solaris/amd64
</span></span><span style=display:flex><span>darwin/arm64     linux/mips      netbsd/amd64   windows/386
</span></span><span style=display:flex><span>dragonfly/amd64  linux/mips64    netbsd/arm     windows/amd64
</span></span><span style=display:flex><span>freebsd/386      linux/mips64le  netbsd/arm64   windows/arm
</span></span></code></pre></div><p>输出是一些以<code>/</code>分割的键值对。键值对的第一个部分，在<code>/</code>之前的是操作系统。在 Go 里面，这些操作系统会是环境变量<code>GOOS</code>的值，发音像“goose”，代表<strong>Go Operation System</strong>。第二部分，在<code>/</code>之后的，是架构。如前所述，这些都是环境变量<code>GOARCH</code>可能的值。这个发音"gore-ch"，代表<strong>Go Architecture</strong>。</p><p>让我们以<code>linux/386</code>为例，对其中的一个组合进行分解，了解它的含义和工作原理。键值对以<code>GOOS</code>开始，在这个例子中是<code>linux</code>，指的是<a href=https://www.digitalocean.com/community/tutorial_series/getting-started-with-linux>Linux 操作系统</a>。这里的<code>GOARCH</code>应该是<code>386</code>，它代表<a href=https://en.wikipedia.org/wiki/Intel_80386>英特尔 80386 微处理器</a>。</p><p>有许多平台可以使用<code>go build</code>命令，但大多数情况下，你最终会使用<code>linux</code> , <code>windows</code>或<code>darwin</code>作为 GOOS 的值。这些涵盖了三大操作系统平台： <a href=https://en.wikipedia.org/wiki/Linux>Linux</a>、<a href=https://en.wikipedia.org/wiki/Microsoft_Windows>Windows</a>和<a href=https://en.wikipedia.org/wiki/MacOS>macOS</a>，后者是基于<a href=https://en.wikipedia.org/wiki/Darwin_%28operating_system%29>Darwin Operating system</a>的，因此被称为<code>darwin</code>。然而，Go 也可以覆盖不太主流的平台，如<code>nacl</code>，它代表了<a href=https://developer.chrome.com/native-client>谷歌的本地客户端</a>。</p><p>当你运行<code>go build</code>这样的命令时，Go 使用当前平台的<code>GOOS</code>和<code>GOARCH</code>来决定如何构建二进制文件。要想知道你的平台是什么组合，你可以使用<code>go env</code>命令，并将<code>GOOS</code>和<code>GOARCH</code>作为参数：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go env GOOS GOARCH
</span></span></code></pre></div><p>在测试这个例子时，我们在一台<a href=https://en.wikipedia.org/wiki/X86-64>AMD64 架构</a>的机器上的 macOS 上运行这个命令，所以我们将收到以下输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>darwin
</span></span><span style=display:flex><span>amd64
</span></span></code></pre></div><p>这个命令的输出告诉我们系统的 GOOS 是 darwin，GOARCH 是 amd64。</p><p>你现在知道了 Go 中的<code>GOOS</code>和<code>GOARCH</code>是什么，以及它们的可能值。接下来，你将编写一个程序，作为如何使用这些环境变量和构建标签为其他平台构建二进制文件的例子。</p><h2 id=用filepathjoin编写一个平台依赖的应用程序>用<code>filepath.Join</code>编写一个平台依赖的应用程序
<a class=anchor href=#%e7%94%a8filepathjoin%e7%bc%96%e5%86%99%e4%b8%80%e4%b8%aa%e5%b9%b3%e5%8f%b0%e4%be%9d%e8%b5%96%e7%9a%84%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f>#</a></h2><p>在你开始构建其他平台的二进制前，让我们先构建一个范例程序。出于这个目的，一个好的例子可以用 Go 标准库中的<a href=https://godoc.org/path/filepath><code>path/filepath</code></a>包内的<code>Join</code>函数。这个函数以多个 string 为传参，并返回一个用正确文件路径分隔符拼接的 string。</p><p>这是一个很好的范例程序，因为该程序的运行取决于它在哪个操作系统上运行。在 Windows 上，路径分隔符是反斜杠，<code>\</code>，而基于 Unix 的系统使用正斜杠，<code>/</code>。</p><p>让我们从构建一个使用<code>filepath.Join()</code>的应用程序开始，稍后，你将编写你自己的<code>Join()</code>函数的实现，将代码定制为特定平台的二进制文件。</p><p>首先，在你的<code>src</code>目录下创建一个文件夹，用你的应用程序的名字命名：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir app
</span></span></code></pre></div><p>进入目录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd app
</span></span></code></pre></div><p>接下来，在你选择的文本编辑器中创建一个名为<code>main.go</code>的新文件。在本教程中，我们将使用 Nano。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano main.go
</span></span></code></pre></div><p>文件打开后，添加如下代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;path/filepath&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#e6db74>&#34;a&#34;</span>, <span style=color:#e6db74>&#34;b&#34;</span>, <span style=color:#e6db74>&#34;c&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在这个文件的<code>main()</code>函数用<code>filepath.Join()</code>将三个<a href=/How-To-Code-in-Go/docs/08-An_Introduction_to_Working_with_Strings_in_Go/>strings</a>用正确的，平台依赖的路径分隔符连接起来。</p><p>保存并退出文件，然后运行程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run main.go
</span></span></code></pre></div><p>当运行这个程序时，你将收到不同的输出，这取决于你所使用的平台。在 Windows 上，你会看到用<code>\</code>分隔的字符串。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>a\b\c
</span></span></code></pre></div><p>在 MacOS 和 Linux 等 Unix 系统上，你将收到以下内容。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>a/b/c
</span></span></code></pre></div><p>这表明，由于这些操作系统使用的文件系统协议不同，程序将不得不为不同的平台构建不同的代码。但由于它已经根据操作系统使用了不同的文件分隔符，所有我们知道<code>filepath.Join()</code>已经考虑了平台的差异。这是因为 Go 工具链会自动检测你的机器的<code>GOOS</code>和<code>GOARCH</code>，并使用这些信息来使用具有正确<a href=/How-To-Code-in-Go/docs/31-Customizing_Go_Binaries_with_Build_Tags/>构建标签</a>和文件分隔符的代码片段。</p><p>让我们思考一下<code>filepath.Join()</code>函数的分隔符是从哪里来的。运行以下命令来查看 Go 标准库中的相关片段：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>less /usr/local/go/src/os/path_unix.go
</span></span></code></pre></div><p>这将显示<code>path_unix.go</code>的内容。寻找该文件的如下部分：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>. . .
</span></span><span style=display:flex><span><span style=color:#75715e>// +build aix darwin dragonfly freebsd js,wasm linux nacl netbsd openbsd solaris
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>os</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>PathSeparator</span>     = <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#75715e>// OS-specific path separator
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>PathListSeparator</span> = <span style=color:#e6db74>&#39;:&#39;</span> <span style=color:#75715e>// OS-specific path list separator
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)
</span></span><span style=display:flex><span>. . .
</span></span></code></pre></div><p>这一段为 Go 为支持的所有类 Unix 系统定义了 <code>PathSeparator</code>。 注意顶部的所有构建标签，它们是与 Unix 相关的每一个可能的 Unix <code>GOOS</code>平台。当<code>GOOS</code>与这些名词匹配时，你的程序将产生 Unix 风格的文件路径分隔符。</p><p>按<code>q</code>返回到命令行。</p><p>接下来，打开定义在 Windows 上使用<code>filepath.Join()</code>时的行为的文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>less /usr/local/go/src/os/path_windows.go
</span></span></code></pre></div><p>你会看到如下内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>. . .
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>os</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PathSeparator</span>     = <span style=color:#e6db74>&#39;\\&#39;</span> <span style=color:#75715e>// OS-specific path separator
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>PathListSeparator</span> = <span style=color:#e6db74>&#39;;&#39;</span>  <span style=color:#75715e>// OS-specific path list separator
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)
</span></span><span style=display:flex><span>. . .
</span></span></code></pre></div><p>虽然<code>PathSeparator</code>的值在这里是<code>\\</code>，但代码将呈现 Windows 文件路径所需的单一反斜杠（<code>\</code>），因为第一个反斜杠只需要作为转义字符。</p><p>请注意，与 Unix 文件不同，它的顶部没有构建标签。这是因为<code>GOOS</code>和<code>GOARCH</code>可以通过在文件后缀加上分隔符和环境变量的值来作为参数传递给<code>go build</code>，这个我们将会在<a href=https://gocn.github.io/How-To-Code-in-Go/docs/38-Building_Go_Applications_for_Different_Operating_Systems_and_Architectures/#%E4%BD%BF%E7%94%A8goos%E5%92%8Cgoarch%E6%96%87%E4%BB%B6%E5%90%8D%E5%90%8E%E7%BC%80>使用 GOOS 和 GOARCH 文件后缀名</a>做更多的研究。这里，<code>path_windows.go</code>的<code>_windows</code>部分使文件的行为就像它在文件的顶部有 build 标签<code>//+build windows</code>。因为这个，但你程序在 windows 上运行时，它将使用<code>path_windows.go</code>代码片段中的<code>PathSeparator</code>和<code>PathListSeparator</code>常量。</p><p>To return to the command line, quit <code>less</code> by pressing <code>q</code>.</p><p>要返回到命令行，按<code>q</code>键退出<code>less</code>。</p><p>在这一步，你建立了一个程序，展示了 Go 如何将<code>GOOS</code>和<code>GOARCH</code>自动转换为构建标签。考虑到这一点，你现在可以更新你的程序，编写你自己的<code>filepath.Join()</code>的实现，使用构建标签为 Windows 和 Unix 平台手动设置正确的<code>PathSeparator</code>。</p><h2 id=实现一个平台特定函数>实现一个平台特定函数
<a class=anchor href=#%e5%ae%9e%e7%8e%b0%e4%b8%80%e4%b8%aa%e5%b9%b3%e5%8f%b0%e7%89%b9%e5%ae%9a%e5%87%bd%e6%95%b0>#</a></h2><p>现在你已经知道 Go 的标准库是如何实现特定平台的代码的，你可以使用构建标签在你自己的<code>应用</code>程序中做到这一点。要做到这一点，你将编写你自己的<code>filepath.Join()</code>的实现。</p><p>打开你的<code>main.go</code>文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano main.go
</span></span></code></pre></div><p>用你自己的函数<code>Join()</code>替换<code>main.go</code>的内容，如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>parts</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>parts</span>, <span style=color:#a6e22e>PathSeparator</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Join</span>(<span style=color:#e6db74>&#34;a&#34;</span>, <span style=color:#e6db74>&#34;b&#34;</span>, <span style=color:#e6db74>&#34;c&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Join 函数接收若干<code>parts</code>，并使用<a href=/How-To-Code-in-Go/docs/08-An_Introduction_to_Working_with_Strings_in_Go/>strings 包</a>中的<a href=https://godoc.org/strings.Join><code>strings.Join()</code></a>方法将它们连接起来，使用<code>PathSeparator</code>将各部分连接起来。</p><p>你还没有定义<code>PathSeparator</code>，所以现在在另一个文件中做。保存并退出<code>main.go</code>，打开你喜欢的编辑器，创建一个名为<code>path.go</code>的新文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>nano path.go
</span></span></code></pre></div><p>定义<code>PathSeparator</code>，并将其设置为 Unix 文件路径分隔符，<code>/</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PathSeparator</span> = <span style=color:#e6db74>&#34;/&#34;</span>
</span></span></code></pre></div><p>编译并运行该应用程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go build
</span></span><span style=display:flex><span>./app
</span></span></code></pre></div><p>你将会收到如下输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>a/b/c
</span></span></code></pre></div><p>这样运行成功，得到一个 Unix 风格的文件路径。但这还不是我们想要的：无论在什么平台上运行，输出总是 a/b/c。为了添加创建 Windows 风格文件路径的功能，你需要添加一个 Windows 版本的<code>PathSeparator</code>，并告诉<code>go build</code>命令使用哪个版本。在下一节中，你将使用<a href=/How-To-Code-in-Go/docs/31-Customizing_Go_Binaries_with_Build_Tags/>构建标签</a>来完成这个任务。</p><h2 id=使用goos或goarch构建标签>使用<code>GOOS</code>或<code>GOARCH</code>构建标签
<a class=anchor href=#%e4%bd%bf%e7%94%a8goos%e6%88%96goarch%e6%9e%84%e5%bb%ba%e6%a0%87%e7%ad%be>#</a></h2><p>为了考虑到 Windows 平台，你现在将创建一个替代文件到<code>path.go</code>，并使用构建标签来确保代码片段只在<code>GOOS</code>和<code>GOARCH</code>是合适的平台时运行。</p><p>但首先，在<code>path.go</code>中添加一个构建标签，告诉它除 Windows 之外的所有东西都可以进行构建。打开该文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano path.go
</span></span></code></pre></div><p>加入如下高亮构建标签到文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// +build !windows
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PathSeparator</span> = <span style=color:#e6db74>&#34;/&#34;</span>
</span></span></code></pre></div><p>Go 构建标签允许反转，也就是说，你可以指示 Go 为除 Windows 之外的任何平台构建此文件。 要反转一个构建标签，请在标签前加上一个<code>!</code>。</p><p>保存并退出文件。</p><p>现在，如果你要在 Windows 上运行这个程序，你会得到以下错误：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>./main.go:9:29: undefined: PathSeparator
</span></span></code></pre></div><p>在这种情况下，Go 将无法通过引入<code>path.go</code>来定义变量<code>PathSeparator</code>。</p><p>现在你已经确保当<code>GOOS</code>是 Windows 时，<code>path.go</code>不会运行，添加一个新的文件，<code>windows.go</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano windows.go
</span></span></code></pre></div><p>在<code>windows.go</code>中，定义 Windows 的<code>PathSeparator</code>，以及一个构建标签让<code>go build</code>命令知道它是 Windows 的实现：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// +build windows
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PathSeparator</span> = <span style=color:#e6db74>&#34;\\&#34;</span>
</span></span></code></pre></div><p>保存文件并从文本编辑器中退出。该应用程序现在可以以一种方式为 Windows 编译，另一种方式为所有其他平台编译。</p><p>虽然现在二进制文件可以在其他平台正确编译，但你必须做进一步的修改，以便为你无法访问的平台进行编译。要做到这一点，你将在下一步改变你的本地<code>GOOS</code>和<code>GOARCH</code>环境变量。</p><h2 id=使用你本地goos和goarch环境变量>使用你本地<code>GOOS</code>和<code>GOARCH</code>环境变量
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e4%bd%a0%e6%9c%ac%e5%9c%b0goos%e5%92%8cgoarch%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f>#</a></h2><p>在前面，你通过执行<code>go env GOOS GOACH</code>指令来找到你正在工作的平台是哪个操作系统和架构。当你执行<code>go env</code>指令时，它会去找 2 个环境变量<code>GOOS</code>和<code>GOARCH</code>；如果找到，他们就会使用环境变量，如果找不到，Go 就会用当前平台的信息来设置它们。这意味着你可以改变<code>GOOS</code>或<code>GOARCH</code>，所以它们不是根据你的操作系统和架构默认设置的。</p><p><code>go build</code>命令的行为方式与<code>go env</code>命令类似。你可以设置<code>GOOS</code>或<code>GOARCH</code>的环境变量，用<code>go build</code>为不同的平台进行编译。</p><p>如果你没有使用<code>Windows</code>系统，可以在运行<code>go build</code>命令时将<code>GOOS</code>环境变量设置为<code>window</code>s，从而构建<code>应用程序</code>windows 下的二进制版本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>GOOS<span style=color:#f92672>=</span>windows go build
</span></span></code></pre></div><p>现在列出你当前目录中的文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls
</span></span></code></pre></div><p>列出目录文件的输出项显示在项目目录中现在有一个<code>app.exe</code>的 Windows 可执行文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>app  app.exe  main.go  path.go  windows.go
</span></span></code></pre></div><p>使用<code>file</code>命令，你可以得到关于这个文件的更多信息，确认它的构建构建信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>file app.exe
</span></span></code></pre></div><p>你将会看到如下信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>app.exe: PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows
</span></span></code></pre></div><p>你也可以在构建时设置一个，或两个环境变量。运行如下命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>GOOS<span style=color:#f92672>=</span>linux GOARCH<span style=color:#f92672>=</span>ppc64 go build
</span></span></code></pre></div><p>你的<code>应用程序</code>的可执行文件现在将被一个不同架构的文件所取代。在这个二进制文件上运行<code>file</code>命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>file app
</span></span></code></pre></div><p>你将会收到类似如下的信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>app: ELF 64-bit MSB executable, 64-bit PowerPC or cisco 7500, version 1 (SYSV), statically linked, not stripped
</span></span></code></pre></div><p>通过设置本地的 <code>GOOS</code> 和 <code>GOARCH</code> 环境变量，你将可以为任何兼容 Go 的平台构建二进制文件，而无需复杂的配置或设置。接下来，你将使用文件名的约定来保持你的文件整齐，并自动为特定平台构建，而不需要构建标签。</p><h2 id=使用goos和goarch文件名后缀>使用<code>GOOS</code>和<code>GOARCH</code>文件名后缀
<a class=anchor href=#%e4%bd%bf%e7%94%a8goos%e5%92%8cgoarch%e6%96%87%e4%bb%b6%e5%90%8d%e5%90%8e%e7%bc%80>#</a></h2><p>正如你之前看到的，Go 标准库大量使用构建标签，通过将不同的平台实现分离到不同的文件中来简化代码。当你打开<code>os/path_unix.go</code>文件时，有一个构建标签，列出了所有被认为是类 Unix 平台的可能组合。然而，<code>os/path_windows.go</code>文件不包含任何构建标签，因为文件名的后缀就足以告诉 Go 该文件是为哪个平台准备的。</p><p>让我们来看看这个功能的语法。命名<code>.go</code>文件时，可以在文件名中按顺序添加<code>GOOS</code>和<code>GOARCH</code>作为后缀，用下划线(<code>_</code>)来分开这两个值。如果你有一个名为<code>filename.go</code>的 Go 文件，你可以通过将文件名改为 <code>filename_GOOS_GOARCH.go</code>来指定操作系统和架构。举个例子，如果你希望将其编译为 64 位<a href=https://en.wikipedia.org/wiki/ARM_architecture>ARM 架构</a>的 Windows，你会将文件名定为<code>filename_windows_arm64.go</code>。这种命名方式有助于保持代码的整齐性。</p><p>使用文件名后缀而非构建标签来更新你的程序。首先，重新命名<code>path.go</code>和<code>windows.go</code>文件，使用<code>os</code>包中使用的惯例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mv path.go path_unix.go
</span></span><span style=display:flex><span>mv windows.go path_windows.go
</span></span></code></pre></div><p>改变了这两个文件名后，你可以删除你添加到<code>path_windows.go</code>的构建标签：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano path_windows.go
</span></span></code></pre></div><p>移除<code>// +build windows</code>，所以你的文件会看起来像这样：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PathSeparator</span> = <span style=color:#e6db74>&#34;\\&#34;</span>
</span></span></code></pre></div><p>保存并退出文件。</p><p>因为<code>unix</code>不是一个有效的<code>GOOS</code>，<code>_unix.go</code>后缀对 Go 编译器没有任何意义。然而，它确实传达了文件的预期目的。 和<code>os/path_unix.go</code>文件一样，你的<code>path_unix.go</code>文件仍然需要使用构建标签，所以保持该文件不变。</p><p>通过使用文件名惯例，你从你的源代码中删除了不需要的构建标签，并使文件系统更干净、更清晰。</p><h2 id=总结>总结
<a class=anchor href=#%e6%80%bb%e7%bb%93>#</a></h2><p>为多个平台生成不需要依赖的二进制文件的能力是 Go 工具链的一个强大功能。在本教程中，你通过添加构建标签和文件名后缀来使用这种能力，以标记某些代码片段，使其只针对某些架构进行编译。你创建了你自己的平台依赖的程序，然后操纵<code>GOOS</code>和<code>GOARCH</code>环境变量，为你当前平台以外的平台生成二进制文件。这是一项有价值的技能，因为有一个持续集成过程，自动运行这些环境变量，为所有平台构建二进制文件，这是一个常见的做法。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#前期准备>前期准备</a></li><li><a href=#goos和goarch可能支持的平台><code>GOOS</code>和<code>GOARCH</code>可能支持的平台</a></li><li><a href=#用filepathjoin编写一个平台依赖的应用程序>用<code>filepath.Join</code>编写一个平台依赖的应用程序</a></li><li><a href=#实现一个平台特定函数>实现一个平台特定函数</a></li><li><a href=#使用goos或goarch构建标签>使用<code>GOOS</code>或<code>GOARCH</code>构建标签</a></li><li><a href=#使用你本地goos和goarch环境变量>使用你本地<code>GOOS</code>和<code>GOARCH</code>环境变量</a></li><li><a href=#使用goos和goarch文件名后缀>使用<code>GOOS</code>和<code>GOARCH</code>文件名后缀</a></li><li><a href=#总结>总结</a></li></ul></nav></div></aside></main></body></html>