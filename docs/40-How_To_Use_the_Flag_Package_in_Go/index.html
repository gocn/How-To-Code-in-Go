<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="在 Go 里面如何使用 Flag 包 # 简介 # 命令行工具很少在没有额外配置的情况下开箱即用。好的默认值固然很重要，但有用的工具需要接受用户的配置。在大多数平台上，命令行工具通过接收标志来指定命令的执行。标志是以键值分隔的字符串，加在命令的名称后面。Go 让你通过使用标准库中的 flag 包来制作接受标志的命令行工具。
在本教程中，你将探索使用 flag 包来建立不同种类的命令行工具的各种方法。你将使用一个标志来控制程序输出，引入位置参数，在这里你将混合标志和其他数据，然后实现子命令。
用 Flag 来改变程序的行为 # 使用 flag 包包括三个步骤：首先，定义变量以捕获标志值，然后定义你的 Go 应用程序将使用的标志，最后解析执行时提供给应用程序的标志。flag包内的大多数函数都与定义标志和将它们与你定义的变量绑定有关。解析阶段由Parse()函数处理。
为了阐述这一点，你将创建一个程序，定义一个 Boolean标志，改变这个标志将会把信息打印到标准输出上。如果提供一个-color标志，程序会用蓝色来打印消息。如果没有这个标志，则打印消息不会有颜色。
创建一个叫boolean.go的文件：
nano boolean.go 添加如下代码到文件里面来创建程序：
package main import ( &#34;flag&#34; &#34;fmt&#34; ) type Color string const ( ColorBlack Color = &#34;\u001b[30m&#34; ColorRed = &#34;\u001b[31m&#34; ColorGreen = &#34;\u001b[32m&#34; ColorYellow = &#34;\u001b[33m&#34; ColorBlue = &#34;\u001b[34m&#34; ColorReset = &#34;\u001b[0m&#34; ) func colorize(color Color, message string) { fmt.Println(string(color), message, string(ColorReset)) } func main() { useColor := flag."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="在 Go 里面如何使用 Flag 包 # 简介 # 命令行工具很少在没有额外配置的情况下开箱即用。好的默认值固然很重要，但有用的工具需要接受用户的配置。在大多数平台上，命令行工具通过接收标志来指定命令的执行。标志是以键值分隔的字符串，加在命令的名称后面。Go 让你通过使用标准库中的 flag 包来制作接受标志的命令行工具。
在本教程中，你将探索使用 flag 包来建立不同种类的命令行工具的各种方法。你将使用一个标志来控制程序输出，引入位置参数，在这里你将混合标志和其他数据，然后实现子命令。
用 Flag 来改变程序的行为 # 使用 flag 包包括三个步骤：首先，定义变量以捕获标志值，然后定义你的 Go 应用程序将使用的标志，最后解析执行时提供给应用程序的标志。flag包内的大多数函数都与定义标志和将它们与你定义的变量绑定有关。解析阶段由Parse()函数处理。
为了阐述这一点，你将创建一个程序，定义一个 Boolean标志，改变这个标志将会把信息打印到标准输出上。如果提供一个-color标志，程序会用蓝色来打印消息。如果没有这个标志，则打印消息不会有颜色。
创建一个叫boolean.go的文件：
nano boolean.go 添加如下代码到文件里面来创建程序：
package main import ( &#34;flag&#34; &#34;fmt&#34; ) type Color string const ( ColorBlack Color = &#34;\u001b[30m&#34; ColorRed = &#34;\u001b[31m&#34; ColorGreen = &#34;\u001b[32m&#34; ColorYellow = &#34;\u001b[33m&#34; ColorBlue = &#34;\u001b[34m&#34; ColorReset = &#34;\u001b[0m&#34; ) func colorize(color Color, message string) { fmt.Println(string(color), message, string(ColorReset)) } func main() { useColor := flag."><meta property="og:type" content="article"><meta property="og:url" content="https://gocn.github.io/How-To-Code-in-Go/docs/40-How_To_Use_the_Flag_Package_in_Go/"><meta property="article:section" content="docs"><title>40 How to Use the Flag Package in Go | How To Code in Go</title><link rel=manifest href=/How-To-Code-in-Go/manifest.json><link rel=icon href=/How-To-Code-in-Go/favicon.png type=image/x-icon><link rel=stylesheet href=/How-To-Code-in-Go/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/How-To-Code-in-Go/flexsearch.min.js></script>
<script defer src=/How-To-Code-in-Go/zh.search.min.2ccdafc211784f64f63652981924d269b4ff643413814bfc0d5743573b76ade7.js integrity="sha256-LM2vwhF4T2T2NlKYGSTSabT/ZDQTgUv8DVdDVzt2rec=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/How-To-Code-in-Go/><span>How To Code in Go</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><p><strong>开始学习</strong></p><ul><li><a href=/How-To-Code-in-Go/docs/01-How_To_Install_Go_and_Set_Up_a_Local-Programming_Environment_on_Ubuntu_18.04_DigitalOcean/>1. 如何在 Ubuntu 18.04 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/02-How_To_Install_Go_and_Set_Up_a_Local_Programming_Environment_on_macOS_DigitalOcean/>2. 如何在 macOS 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/03-How_To_Install_Go_and_Set_Up_a_Local_Programming_Environment_on_Windows_10_DigitalOcean/>3. 如何在 Windows 10 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/04-How_To_Write_Your_First_Program_in_Go_DigitalOcean/>4. 如何用 Go 编写你的第一个程序</a></li><li><a href=/How-To-Code-in-Go/docs/05-Understanding_the_GOPATH/>5. 理解 GOPATH</a></li><li><a href=/How-To-Code-in-Go/docs/06-How_To_Write_Comments_in_Go/>6. 如何在 Go 中写注释</a></li><li><a href=/How-To-Code-in-Go/docs/07-Understanding_Data_Types_in_Go/>7. 理解 Go 的数据类型</a></li><li><a href=/How-To-Code-in-Go/docs/08-An_Introduction_to_Working_with_Strings_in_Go/>8. Go 中处理字符串的介绍</a></li><li><a href=/How-To-Code-in-Go/docs/09-How_To_Format_Strings_in_Go/>9. 如何在 Go 中格式化字符串</a></li><li><a href=/How-To-Code-in-Go/docs/10-An_Introduction_to_the_Strings_Package_in_Go/>10. 介绍 Go 中的 Strings 包</a></li><li><a href=/How-To-Code-in-Go/docs/11-How_To_Use_Variables_and_Constants_in_Go/>11. 如何在 Go 中使用变量和常量</a></li><li><a href=/How-To-Code-in-Go/docs/12-How_To_Convert_Data_Types_in_Go/>12. 如何在 Go 中转换数据类型</a></li><li><a href=/How-To-Code-in-Go/docs/13-How_To_Do_Math_in_Go_with_Operators/>13. 如何用运算符在 Go 中做数学计算</a></li><li><a href=/How-To-Code-in-Go/docs/14-Understanding_Boolean_Logic_in_Go/>14. 理解 Go 中的布尔逻辑</a></li><li><a href=/How-To-Code-in-Go/docs/15-Understanding_Maps_in_Go/>15. 理解 Go 中的 Map</a></li><li><a href=/How-To-Code-in-Go/docs/16-Understanding_Arrays_and_Slices_in_Go/>16. 理解 Go 中的数组和切片</a></li><li><a href=/How-To-Code-in-Go/docs/17-Handling_Errors_in_Go_DigitalOcean/>17. 在 Go 中处理错误</a></li><li><a href=/How-To-Code-in-Go/docs/18-Creating_Custom_Errors_in_Go_DigitalOcean/>18. 在 Go 中创建自定义错误</a></li><li><a href=/How-To-Code-in-Go/docs/19-Handling_Panics_in_Go-_DigitalOcean/>19 在 Go 中处理恐慌</a></li><li><a href=/How-To-Code-in-Go/docs/20-Importing_Packages_in_Go_DigitalOcean/>20. 在 Go 中导入包</a></li><li><a href=/How-To-Code-in-Go/docs/21-How_To_Write_Packages_in_Go/>21. 如何在 Go 中编写包</a></li><li><a href=/How-To-Code-in-Go/docs/22-Understanding_Package_Visibility_in_Go/>22. 理解 Go 中包的可见性</a></li><li><a href=/How-To-Code-in-Go/docs/23-How_To_Write_Conditional_Statements_in_Go/>23. 如何在 Go 中编写条件语句</a></li><li><a href=/How-To-Code-in-Go/docs/24-How_To_Write_Switch_Statements_in_Go/>24. 如何在 Go 中编写 Switch 语句</a></li><li><a href=/How-To-Code-in-Go/docs/25-How_To_Construct_For_Loops_in_Go/>25. 如何在 Go 中构造 for 循环</a></li><li><a href=/How-To-Code-in-Go/docs/26-Using_Break_and_Continue_Statements_When_Working_with_Loops_in_Go/>26. 在循环中使用 Break 和 Continue</a></li><li><a href=/How-To-Code-in-Go/docs/27-How_To_Define_and_Call_Functions_in_Go/>27. 如何在 Go 中定义并调用函数</a></li><li><a href=/How-To-Code-in-Go/docs/28-How_To_Use_Variadic_Functions_in_Go/>28. 如何在 Go 中使用可变参数函数</a></li><li><a href=/How-To-Code-in-Go/docs/29-Understanding_defer_in_Go/>29. 理解 Go 中的 defer</a></li><li><a href=/How-To-Code-in-Go/docs/30-Understanding_init_in_Go/>30. 理解 Go 中的 init</a></li><li><a href=/How-To-Code-in-Go/docs/31-Customizing_Go_Binaries_with_Build_Tags/>31. 用构建标签定制 Go 二进制文件</a></li><li><a href=/How-To-Code-in-Go/docs/32-Understanding_Pointers_in_Go/>32. 理解 Go 中的指针</a></li><li><a href=/How-To-Code-in-Go/docs/33-Defining_Structs_in_Go/>33. 在 Go 中定义结构体</a></li><li><a href=/How-To-Code-in-Go/docs/34-Defining_Methods_in_Go/>34. 在 Go 中定义方法</a></li><li><a href=/How-To-Code-in-Go/docs/35-How_To_Build_and_Install_Go_Programs/>35. 如何构建和安装 Go 程序</a></li><li><a href=/How-To-Code-in-Go/docs/36-How_To_Use_Struct_Tags_in_Go/>36. 如何在 Go 中使用结构体标签</a></li><li><a href=/How-To-Code-in-Go/docs/37-How_To_Use_Interfaces_in_Go/>37. 如何在 Go 使用 interface</a></li><li><a href=/How-To-Code-in-Go/docs/38-Building_Go_Applications_for_Different_Operating_Systems_and_Architectures/>38. 在不同的操作系统和架构编译 Go 应用</a></li><li><a href=/How-To-Code-in-Go/docs/39-Using_ldflags_to_Set_Version_Information_for_Go_Applications/>39. 用 ldflags 设置 Go 应用程序的版本信息</a></li><li><a href=/How-To-Code-in-Go/docs/40-How_To_Use_the_Flag_Package_in_Go/ class=active>40. 在 Go 里面如何使用 Flag 包</a></li><li><a href=/How-To-Code-in-Go/docs/41-How_to_Use_Go_Modules/>41. 如何使用 Go 模块</a></li><li><a href=/How-To-Code-in-Go/docs/42-How_to_Distribute_Go_Modules/>42. 如何分发 Go 模块</a></li><li><a href=/How-To-Code-in-Go/docs/43-How_to_Use_a_Private_Go_Module_in_Your_Own_Project/>43. 如何在自己的项目中使用私有的Go模块</a></li></ul></li><li><p><strong>附录：资源</strong></p></li><li><p><a href=https://github.com/gocn/How-To-Code-in-Go><strong>Fork on Github</strong></a></p></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/How-To-Code-in-Go/svg/menu.svg class=book-icon alt=Menu></label>
<strong>40 How to Use the Flag Package in Go</strong>
<label for=toc-control><img src=/How-To-Code-in-Go/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#用-flag-来改变程序的行为>用 Flag 来改变程序的行为</a></li><li><a href=#使用位置参数>使用位置参数</a></li><li><a href=#用-flagset-来实现子命令>用 FlagSet 来实现子命令</a></li><li><a href=#总结>总结</a></li></ul></nav></aside></header><article class=markdown><h1 id=在-go-里面如何使用-flag-包>在 Go 里面如何使用 Flag 包
<a class=anchor href=#%e5%9c%a8-go-%e9%87%8c%e9%9d%a2%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8-flag-%e5%8c%85>#</a></h1><h2 id=简介>简介
<a class=anchor href=#%e7%ae%80%e4%bb%8b>#</a></h2><p>命令行工具很少在没有额外配置的情况下开箱即用。好的默认值固然很重要，但有用的工具需要接受用户的配置。在大多数平台上，命令行工具通过接收标志来指定命令的执行。标志是以键值分隔的字符串，加在命令的名称后面。Go 让你通过使用标准库中的 flag 包来制作接受标志的命令行工具。</p><p>在本教程中，你将探索使用 flag 包来建立不同种类的命令行工具的各种方法。你将使用一个标志来控制程序输出，引入位置参数，在这里你将混合标志和其他数据，然后实现子命令。</p><h2 id=用-flag-来改变程序的行为>用 Flag 来改变程序的行为
<a class=anchor href=#%e7%94%a8-flag-%e6%9d%a5%e6%94%b9%e5%8f%98%e7%a8%8b%e5%ba%8f%e7%9a%84%e8%a1%8c%e4%b8%ba>#</a></h2><p>使用 flag 包包括三个步骤：首先，定义变量以捕获标志值，然后定义你的 Go 应用程序将使用的标志，最后解析执行时提供给应用程序的标志。<code>flag</code>包内的大多数函数都与定义标志和将它们与你定义的变量绑定有关。解析阶段由<code>Parse()</code>函数处理。</p><p>为了阐述这一点，你将创建一个程序，定义一个 <a href=/How-To-Code-in-Go/docs/14-Understanding_Boolean_Logic_in_Go/>Boolean</a>标志，改变这个标志将会把信息打印到标准输出上。如果提供一个<code>-color</code>标志，程序会用蓝色来打印消息。如果没有这个标志，则打印消息不会有颜色。</p><p>创建一个叫<code>boolean.go</code>的文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano boolean.go
</span></span></code></pre></div><p>添加如下代码到文件里面来创建程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Color</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ColorBlack</span>  <span style=color:#a6e22e>Color</span> = <span style=color:#e6db74>&#34;\u001b[30m&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ColorRed</span>          = <span style=color:#e6db74>&#34;\u001b[31m&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ColorGreen</span>        = <span style=color:#e6db74>&#34;\u001b[32m&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ColorYellow</span>       = <span style=color:#e6db74>&#34;\u001b[33m&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ColorBlue</span>         = <span style=color:#e6db74>&#34;\u001b[34m&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ColorReset</span>        = <span style=color:#e6db74>&#34;\u001b[0m&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>colorize</span>(<span style=color:#a6e22e>color</span> <span style=color:#a6e22e>Color</span>, <span style=color:#a6e22e>message</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(string(<span style=color:#a6e22e>color</span>), <span style=color:#a6e22e>message</span>, string(<span style=color:#a6e22e>ColorReset</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>useColor</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Bool</span>(<span style=color:#e6db74>&#34;color&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;display colorized output&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Parse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>useColor</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>colorize</span>(<span style=color:#a6e22e>ColorBlue</span>, <span style=color:#e6db74>&#34;Hello, DigitalOcean!&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Hello, DigitalOcean!&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这个例子使用<a href=https://en.wikipedia.org/wiki/ANSI_escape_code>ANSI 逃逸序列</a>来指示终端显示彩色输出。这些是专门的 character 序列，所以为它们定义一个新的类型是有意义的(L8)。在这个例子中，我们称该类型为<code>color</code>，并将该类型定义为<code>string</code>。然后我们定义了一个调色板，在后面的 <code>const</code> 块中使用。定义在<code>const</code>块之后的<code>colorize</code>函数接受<code>Color</code>常量其中之一和一个<code>string</code>，用于对信息进行着色。然后它指示终端改变颜色，首先打印所要求的颜色的转义序列，然后打印信息，最后要求终端通过打印特殊的颜色重置序列来重置其颜色。</p><p>在<code>main</code>中，我们使用<code>flag.Bool</code>函数来定义一个名为<code>color</code>的 Boolean 标志。这个函数的第二个参数，<code>false</code>，在没有提供这个标志的情况下，设置这个标志的默认值。与你可能有的期望相反，将其设置为<code>true</code>并不会颠倒行为，如提供一个标志会导致它变成 false。因此，这个参数的值在布尔标志下几乎总是<code>false</code>。</p><p>最后一个参数是一个可以作为使用信息打印出来的文档 string。从这个函数返回的值是一个指向<code>bool</code>的指针。下一行的<code>flag.Parse</code>函数使用这个指针，然后根据用户传入的标志，设置<code>bool</code>变量。 然后我们就可以通过取消引用这个指针来检查这个<code>bool</code>指针的值。更多关于指针变量的信息可以在<a href=/How-To-Code-in-Go/docs/32-Understanding_Pointers_in_Go/>指针教程</a>找到。使用这个 Boolean，我们就可以在设置<code>-color</code>标志时调用<code>colorize</code>，而在没有这个标志时调用<code>fmt.Println</code>变量。</p><p>保存文件，并在未传入没有任何标志的情况下运行该程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run boolean.go
</span></span></code></pre></div><p>你将会看到如下输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>Hello, DigitalOcean!
</span></span></code></pre></div><p>现在带上<code>-color</code>标志再跑一遍程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run boolean.go -color
</span></span></code></pre></div><p>输出文本会是一样的，只不过这时候颜色时蓝色的。</p><p>标志不是传递给命令的唯一参数。你也能发送文件名或其他数据。</p><h2 id=使用位置参数>使用位置参数
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e4%bd%8d%e7%bd%ae%e5%8f%82%e6%95%b0>#</a></h2><p>通常情况下，命令会接受一些参数，这些参数作为命令的重点对象。例如，打印文件第一行的<code>head</code>命令经常被以<code>head example.txt</code>调用。文件<code>example.txt</code>是调用<code>head</code>命令时的一个位置参数。</p><p><code>Parse()</code>函数将一直解析它所遇到的标志，直到它检测到一个非标志参数。<code>flag</code>包通过<code>Args()</code>和<code>Arg()</code>函数使这些参数可用。</p><p>为了阐述这一点，你将重新实现一个简化的<code>head</code>命令，它显示一个给定文件的前几行：</p><p>创建一个新的文件称为<code>head.go</code>，然后添加如下代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;bufio&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;io&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>count</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>IntVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>count</span>, <span style=color:#e6db74>&#34;n&#34;</span>, <span style=color:#ae81ff>5</span>, <span style=color:#e6db74>&#34;number of lines to read from the file&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Parse</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>filename</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>Arg</span>(<span style=color:#ae81ff>0</span>); <span style=color:#a6e22e>filename</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>filename</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;error opening file: err:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>in</span> = <span style=color:#a6e22e>f</span>
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>in</span> = <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdin</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>buf</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>in</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>count</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>Text</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>buf</span>.<span style=color:#a6e22e>Err</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintln</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stderr</span>, <span style=color:#e6db74>&#34;error reading: err:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>首先，我们定义了一个<code>count</code>变量，用来保存程序应该从文件中读取的行数。然后，我们使用<code>flag.IntVar</code>定义<code>-n</code>标志，模拟原始<code>head</code>程序的行为。 这个函数允许我们将自己的<a href=/How-To-Code-in-Go/docs/32-Understanding_Pointers_in_Go/>pointer</a>传递给一个变量，与没有<code>Var</code>后缀的标志函数相反。除了这个区别之外，<code>flag.IntVar</code>的其他参数与<code>flag.Int</code>对应的参数相同：标志名称、默认值和描述。 和前面的例子一样，我们随后调用<code>flag.Parse()</code>来处理用户的输入。</p><p>下一节读取文件。我们首先定义一个<code>io.Reader</code>变量，该变量将被设置为用户请求的文件，或传递给程序的标准输入。在<code>if</code>语句中，我们使用<code>flag.Arg</code>函数来访问所有标志之后的第一个位置参数。如果用户提供了文件名，这个位置参数会被设置。否则，它将为空 string(<code>""</code>)。当文件名提供时，我们使用<code>os.Open</code>函数来打开该文件，并将我们之前定义的<code>io.Reader</code>设置为该文件。否则，我们使用<code>os.stdin</code>来读取标准输入。</p><p>最后一节使用一个用<code>bufio.NewScanner</code>创建的<code>*bufio.Scanner</code>从<code>io.Reader</code>变量<code>in</code>中读取行数据。我们使用<a href=/How-To-Code-in-Go/docs/25-How_To_Construct_For_Loops_in_Go/><code>for</code>loop</a>遍历到 count 的值，如果用<code>buf.Scan</code>扫描该行结果为<code>false</code>，则调用<code>break</code>，表示行数少于用户要求的数量。</p><p>运行这个程序，用<code>head.go</code>作为文件参数，显示你刚才写的文件的内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run head.go -- head.go
</span></span></code></pre></div><p><code>--</code>分隔符是一个被<code>flag</code>包识别的特殊标志，它表示后面没有更多的 flag 参数。当你运行这个命令时，你会收到以下输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>package main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import (
</span></span><span style=display:flex><span>        &#34;bufio&#34;
</span></span><span style=display:flex><span>        &#34;flag&#34;
</span></span></code></pre></div><p>使用你定义的<code>-n</code>标志来调整输出的数量：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run head.go -n <span style=color:#ae81ff>1</span> head.go
</span></span></code></pre></div><p>这只输出包的声明：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>package main
</span></span></code></pre></div><p>最后，当程序检测到没有提供位置参数时，它从标准输入中读取输入，就像<code>head</code>一样。试着运行这个命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;fish\nlobsters\nsharks\nminnows&#34;</span> | go run head.go -n <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><p>你将会看到如下输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>fish
</span></span><span style=display:flex><span>lobsters
</span></span><span style=display:flex><span>sharks
</span></span></code></pre></div><p>到目前为止，你所看到的<code>flag</code>函数的行为仅限于检查整个命令的调用。你并不总是想要这种行为，特别是当你在编写一个支持子命令的命令行工具时。</p><h2 id=用-flagset-来实现子命令>用 FlagSet 来实现子命令
<a class=anchor href=#%e7%94%a8-flagset-%e6%9d%a5%e5%ae%9e%e7%8e%b0%e5%ad%90%e5%91%bd%e4%bb%a4>#</a></h2><p>现代的命令行应用程序经常实现 &ldquo;子命令&rdquo;，将一套工具捆绑在一个命令之下。使用这种模式的最著名的工具是<code>git</code>。 当检查像<code>git init</code>这样的命令时，<code>git</code>是命令，<code>init</code>是 git 的子命令。子命令的一个显著特点是，每个子命令可以有自己的标志集合。</p><p>Go 应用程序可以使用<code>flag.(*FlagSet)</code>类型支持具有自己的标志集的子命令。为了阐述这一点，创建一个程序，使用两个具有不同标志的子命令来实现一个命令。</p><p>创建一个名为<code>subcommand.go</code>的新文件，并在该文件中添加以下内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewGreetCommand</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>GreetCommand</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>gc</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>GreetCommand</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fs</span>: <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>NewFlagSet</span>(<span style=color:#e6db74>&#34;greet&#34;</span>, <span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>ContinueOnError</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>gc</span>.<span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>gc</span>.<span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;World&#34;</span>, <span style=color:#e6db74>&#34;name of the person to be greeted&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>gc</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>GreetCommand</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fs</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>flag</span>.<span style=color:#a6e22e>FlagSet</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>g</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>GreetCommand</span>) <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>Name</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>g</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>GreetCommand</span>) <span style=color:#a6e22e>Init</span>(<span style=color:#a6e22e>args</span> []<span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>Parse</span>(<span style=color:#a6e22e>args</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>g</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>GreetCommand</span>) <span style=color:#a6e22e>Run</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Hello&#34;</span>, <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#34;!&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Runner</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Init</span>([]<span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Run</span>() <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>root</span>(<span style=color:#a6e22e>args</span> []<span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>args</span>) &lt; <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;You must pass a sub-command&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>cmds</span> <span style=color:#f92672>:=</span> []<span style=color:#a6e22e>Runner</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>NewGreetCommand</span>(),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>subcommand</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Args</span>[<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>cmd</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>cmds</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Name</span>() <span style=color:#f92672>==</span> <span style=color:#a6e22e>subcommand</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Init</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Args</span>[<span style=color:#ae81ff>2</span>:])
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Run</span>()
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Unknown subcommand: %s&#34;</span>, <span style=color:#a6e22e>subcommand</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>root</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Args</span>[<span style=color:#ae81ff>1</span>:]); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这个程序分为几个部分：<code>main</code>函数，<code>root</code>函数，以及实现子命令的各个函数。<code>main</code>函数处理从命令返回的错误。如果任何函数返回<a href=/How-To-Code-in-Go/docs/17-Handling_Errors_in_Go_DigitalOcean/>错误</a>，<code>if</code>语句将捕捉到它，打印出错误，程序将以<code>1</code>的状态码退出，向操作系统的其他部分表明发生了错误。在<code>main</code>中，我们将程序被调用的所有参数传递给<code>root</code>。我们通过先将<code>os.Args</code>切片来删除第一个参数，也就是程序的名称（在前面的例子中是<code>./subcommand</code>）。</p><p><code>root</code>函数定义了<code>[]Runner</code>，所有的子命令都会在这里定义。<code>Runner</code>是一个子命令的 <a href=/How-To-Code-in-Go/docs/37-How_To_Use_Interfaces_in_Go/>interface</a> ，允许<code>root</code>使用<code>Name()</code>获取子命令的名称，并将其与变量<code>subcommand</code>内容进行比较。一旦在遍历<code>cmds</code>变量后找到了正确的子命令，我们就用其余的参数初始化子命令，并调用该命令的<code>Run()</code>方法。</p><p>我们只定义了一个子命令，尽管这个框架很容易让我们创建其他子命令。<code>GreetCommand</code>是使用<code>NewGreetCommand</code>实例化的，在这里我们使用<code>flag.NewFlagSet</code>创建一个新的<code>*flag.FlagSet</code>。<code>flag.NewFlagSet</code>需要两个参数：一个标志集的名称，和一个报告解析错误的策略。用<code>flag.(*FlagSet).Name</code>方法获取<code>*flag.FlagSet</code>的名称。我们在<code>(*GreetCommand).Name()</code>方法中使用这个方法，所以子命令的名字与我们给<code>*flag.FlagSet</code>的名字一致。 <code>NewGreetCommand</code>也用了类似于以前的例子的方式定义了一个<code>-name</code>标志，但它改为从<code>*GreetCommand</code>的<code>*flag.FlagSet</code>字段中调用这个方法，<code>gc.fs</code>。当<code>root</code>调用<code>*GreetCommand</code>的<code>Init()</code>方法时，我们将传入的参数传递给<code>*flag.FlagSet</code>字段的<code>Parse</code>方法。</p><p>如果你构建这个程序，然后运行它，就会更容易看到子命令。建立该程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go build subcommand.go
</span></span></code></pre></div><p>现在运行该程序，没有参数：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./subcommand
</span></span></code></pre></div><p>你会看到如下输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>You must pass a sub-command
</span></span></code></pre></div><p>现在用<code>greet</code>子命令运行该程序。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./subcommand greet
</span></span></code></pre></div><p>这会输出如下内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>Hello World !
</span></span></code></pre></div><p>现在使用<code>-name</code>标志和<code>greet</code>来指定一个名字：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./subcommand greet -name Sammy
</span></span></code></pre></div><p>你会看到程序给出的这个输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Output
</span></span><span style=display:flex><span>Hello Sammy !
</span></span></code></pre></div><p>这个例子说明了在 Go 中如何构建大型命令行应用程序的一些原则。 <code>FlagSets</code>的设计是为了给开发者提供更多的控制权，使其能够通过 flag 解析逻辑，分析<code>flag</code>的位置和处理方式。</p><h2 id=总结>总结
<a class=anchor href=#%e6%80%bb%e7%bb%93>#</a></h2><p>标记使你的应用程序在更多情景下更有用，因为它们让你的用户控制程序的执行方式。给用户提供有用的默认值很重要，但你应该让他们有机会覆盖那些不适合他们情况的设置。你已经看到，<code>flag</code>包提供了灵活的选择，向你的用户展示配置选项。你可以选择一些简单的标志，或者建立一套可扩展的子命令。 无论是哪种情况，在过去长久历史沉淀的风格下，使用<code>flag</code>包都可以帮助你按照灵活的、可编写脚本的命令行工具。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#用-flag-来改变程序的行为>用 Flag 来改变程序的行为</a></li><li><a href=#使用位置参数>使用位置参数</a></li><li><a href=#用-flagset-来实现子命令>用 FlagSet 来实现子命令</a></li><li><a href=#总结>总结</a></li></ul></nav></div></aside></main></body></html>