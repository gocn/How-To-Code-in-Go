<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="如何在自己的项目中使用私有的Go模块 # 简介 # Go 的生态系统的一个优势是大量的模块是开源的。由于它们是开源的，所以可以自由访问、检查、使用和学习。然而，有时出于各种原因，有必要制作一个私有的 Go 模块，例如在公司内部保留专有的商业逻辑。
在本教程中，你将发布一个私有 Go 模块，设置访问私有模块的认证，并在项目中使用一个私有 Go 模块。
前期准备 # 安装1.16 或更高版本的 Go。如何安装 Go ，请根据你的操作系统遵循 如何安装Go 教程。 对分发 Go 模块的理解，可以在 如何分发 Go 模块 教程中找到。 熟悉Git，你可以参考 How To Use Git: A Reference Guide 。 一个名为 mysecret 的空的 GitHub 私有仓库，用于发布你的私有模块。要开始使用，请遵循 GitHub 创建仓库的文档。 一个可以从你的仓库读取的GitHub 个人访问令牌。你将用它来允许 Go 访问你的私有仓库。 分发一个私有模块 # 与许多编程语言不同，Go 从仓库而不是中央包服务器发布模块。这种方法的一个好处是，发布私有模块与发布公共模块非常相似。Go 的私有模块不需要一个完全独立的私有包服务器，而是通过一个私有源代码库发布。由于大多数源代码托管选项都支持开箱即用，所以不需要再建立一个额外的私有服务器。
为了使用私有模块，你需要访问一个私有 Go 模块。在本节中，你将创建并发布一个私有模块，你可以在以后的教程中使用，从另一个 Go 程序中访问一个私有模块。
要创建新的私有 Go 模块，首先要克隆它所在的私有 GitHub 仓库。作为先决条件的一部分，你在 GitHub 账户中创建了一个名为 mysecret 的私有空仓库，这就是你将用于私有模块的仓库。这个仓库可以在你的电脑上的任何地方克隆，但许多开发者倾向于为他们的项目建立一个目录。在本教程中，你将使用一个名为 projects 的目录。"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="如何在自己的项目中使用私有的Go模块 # 简介 # Go 的生态系统的一个优势是大量的模块是开源的。由于它们是开源的，所以可以自由访问、检查、使用和学习。然而，有时出于各种原因，有必要制作一个私有的 Go 模块，例如在公司内部保留专有的商业逻辑。
在本教程中，你将发布一个私有 Go 模块，设置访问私有模块的认证，并在项目中使用一个私有 Go 模块。
前期准备 # 安装1.16 或更高版本的 Go。如何安装 Go ，请根据你的操作系统遵循 如何安装Go 教程。 对分发 Go 模块的理解，可以在 如何分发 Go 模块 教程中找到。 熟悉Git，你可以参考 How To Use Git: A Reference Guide 。 一个名为 mysecret 的空的 GitHub 私有仓库，用于发布你的私有模块。要开始使用，请遵循 GitHub 创建仓库的文档。 一个可以从你的仓库读取的GitHub 个人访问令牌。你将用它来允许 Go 访问你的私有仓库。 分发一个私有模块 # 与许多编程语言不同，Go 从仓库而不是中央包服务器发布模块。这种方法的一个好处是，发布私有模块与发布公共模块非常相似。Go 的私有模块不需要一个完全独立的私有包服务器，而是通过一个私有源代码库发布。由于大多数源代码托管选项都支持开箱即用，所以不需要再建立一个额外的私有服务器。
为了使用私有模块，你需要访问一个私有 Go 模块。在本节中，你将创建并发布一个私有模块，你可以在以后的教程中使用，从另一个 Go 程序中访问一个私有模块。
要创建新的私有 Go 模块，首先要克隆它所在的私有 GitHub 仓库。作为先决条件的一部分，你在 GitHub 账户中创建了一个名为 mysecret 的私有空仓库，这就是你将用于私有模块的仓库。这个仓库可以在你的电脑上的任何地方克隆，但许多开发者倾向于为他们的项目建立一个目录。在本教程中，你将使用一个名为 projects 的目录。"><meta property="og:type" content="article"><meta property="og:url" content="https://gocn.github.io/How-To-Code-in-Go/docs/43-How_to_Use_a_Private_Go_Module_in_Your_Own_Project/"><meta property="article:section" content="docs"><title>43 How to Use a Private Go Module in Your Own Project | How To Code in Go</title><link rel=manifest href=/How-To-Code-in-Go/manifest.json><link rel=icon href=/How-To-Code-in-Go/favicon.png type=image/x-icon><link rel=stylesheet href=/How-To-Code-in-Go/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/How-To-Code-in-Go/flexsearch.min.js></script>
<script defer src=/How-To-Code-in-Go/zh.search.min.2ccdafc211784f64f63652981924d269b4ff643413814bfc0d5743573b76ade7.js integrity="sha256-LM2vwhF4T2T2NlKYGSTSabT/ZDQTgUv8DVdDVzt2rec=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/How-To-Code-in-Go/><span>How To Code in Go</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><p><strong>开始学习</strong></p><ul><li><a href=/How-To-Code-in-Go/docs/01-How_To_Install_Go_and_Set_Up_a_Local-Programming_Environment_on_Ubuntu_18.04_DigitalOcean/>1. 如何在 Ubuntu 18.04 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/02-How_To_Install_Go_and_Set_Up_a_Local_Programming_Environment_on_macOS_DigitalOcean/>2. 如何在 macOS 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/03-How_To_Install_Go_and_Set_Up_a_Local_Programming_Environment_on_Windows_10_DigitalOcean/>3. 如何在 Windows 10 上安装 Go 和设置本地编程环境</a></li><li><a href=/How-To-Code-in-Go/docs/04-How_To_Write_Your_First_Program_in_Go_DigitalOcean/>4. 如何用 Go 编写你的第一个程序</a></li><li><a href=/How-To-Code-in-Go/docs/05-Understanding_the_GOPATH/>5. 理解 GOPATH</a></li><li><a href=/How-To-Code-in-Go/docs/06-How_To_Write_Comments_in_Go/>6. 如何在 Go 中写注释</a></li><li><a href=/How-To-Code-in-Go/docs/07-Understanding_Data_Types_in_Go/>7. 理解 Go 的数据类型</a></li><li><a href=/How-To-Code-in-Go/docs/08-An_Introduction_to_Working_with_Strings_in_Go/>8. Go 中处理字符串的介绍</a></li><li><a href=/How-To-Code-in-Go/docs/09-How_To_Format_Strings_in_Go/>9. 如何在 Go 中格式化字符串</a></li><li><a href=/How-To-Code-in-Go/docs/10-An_Introduction_to_the_Strings_Package_in_Go/>10. 介绍 Go 中的 Strings 包</a></li><li><a href=/How-To-Code-in-Go/docs/11-How_To_Use_Variables_and_Constants_in_Go/>11. 如何在 Go 中使用变量和常量</a></li><li><a href=/How-To-Code-in-Go/docs/12-How_To_Convert_Data_Types_in_Go/>12. 如何在 Go 中转换数据类型</a></li><li><a href=/How-To-Code-in-Go/docs/13-How_To_Do_Math_in_Go_with_Operators/>13. 如何用运算符在 Go 中做数学计算</a></li><li><a href=/How-To-Code-in-Go/docs/14-Understanding_Boolean_Logic_in_Go/>14. 理解 Go 中的布尔逻辑</a></li><li><a href=/How-To-Code-in-Go/docs/15-Understanding_Maps_in_Go/>15. 理解 Go 中的 Map</a></li><li><a href=/How-To-Code-in-Go/docs/16-Understanding_Arrays_and_Slices_in_Go/>16. 理解 Go 中的数组和切片</a></li><li><a href=/How-To-Code-in-Go/docs/17-Handling_Errors_in_Go_DigitalOcean/>17. 在 Go 中处理错误</a></li><li><a href=/How-To-Code-in-Go/docs/18-Creating_Custom_Errors_in_Go_DigitalOcean/>18. 在 Go 中创建自定义错误</a></li><li><a href=/How-To-Code-in-Go/docs/19-Handling_Panics_in_Go-_DigitalOcean/>19 在 Go 中处理恐慌</a></li><li><a href=/How-To-Code-in-Go/docs/20-Importing_Packages_in_Go_DigitalOcean/>20. 在 Go 中导入包</a></li><li><a href=/How-To-Code-in-Go/docs/21-How_To_Write_Packages_in_Go/>21. 如何在 Go 中编写包</a></li><li><a href=/How-To-Code-in-Go/docs/22-Understanding_Package_Visibility_in_Go/>22. 理解 Go 中包的可见性</a></li><li><a href=/How-To-Code-in-Go/docs/23-How_To_Write_Conditional_Statements_in_Go/>23. 如何在 Go 中编写条件语句</a></li><li><a href=/How-To-Code-in-Go/docs/24-How_To_Write_Switch_Statements_in_Go/>24. 如何在 Go 中编写 Switch 语句</a></li><li><a href=/How-To-Code-in-Go/docs/25-How_To_Construct_For_Loops_in_Go/>25. 如何在 Go 中构造 for 循环</a></li><li><a href=/How-To-Code-in-Go/docs/26-Using_Break_and_Continue_Statements_When_Working_with_Loops_in_Go/>26. 在循环中使用 Break 和 Continue</a></li><li><a href=/How-To-Code-in-Go/docs/27-How_To_Define_and_Call_Functions_in_Go/>27. 如何在 Go 中定义并调用函数</a></li><li><a href=/How-To-Code-in-Go/docs/28-How_To_Use_Variadic_Functions_in_Go/>28. 如何在 Go 中使用可变参数函数</a></li><li><a href=/How-To-Code-in-Go/docs/29-Understanding_defer_in_Go/>29. 理解 Go 中的 defer</a></li><li><a href=/How-To-Code-in-Go/docs/30-Understanding_init_in_Go/>30. 理解 Go 中的 init</a></li><li><a href=/How-To-Code-in-Go/docs/31-Customizing_Go_Binaries_with_Build_Tags/>31. 用构建标签定制 Go 二进制文件</a></li><li><a href=/How-To-Code-in-Go/docs/32-Understanding_Pointers_in_Go/>32. 理解 Go 中的指针</a></li><li><a href=/How-To-Code-in-Go/docs/33-Defining_Structs_in_Go/>33. 在 Go 中定义结构体</a></li><li><a href=/How-To-Code-in-Go/docs/34-Defining_Methods_in_Go/>34. 在 Go 中定义方法</a></li><li><a href=/How-To-Code-in-Go/docs/35-How_To_Build_and_Install_Go_Programs/>35. 如何构建和安装 Go 程序</a></li><li><a href=/How-To-Code-in-Go/docs/36-How_To_Use_Struct_Tags_in_Go/>36. 如何在 Go 中使用结构体标签</a></li><li><a href=/How-To-Code-in-Go/docs/37-How_To_Use_Interfaces_in_Go/>37. 如何在 Go 使用 interface</a></li><li><a href=/How-To-Code-in-Go/docs/38-Building_Go_Applications_for_Different_Operating_Systems_and_Architectures/>38. 在不同的操作系统和架构编译 Go 应用</a></li><li><a href=/How-To-Code-in-Go/docs/39-Using_ldflags_to_Set_Version_Information_for_Go_Applications/>39. 用 ldflags 设置 Go 应用程序的版本信息</a></li><li><a href=/How-To-Code-in-Go/docs/40-How_To_Use_the_Flag_Package_in_Go/>40. 在 Go 里面如何使用 Flag 包</a></li><li><a href=/How-To-Code-in-Go/docs/41-How_to_Use_Go_Modules/>41. 如何使用 Go 模块</a></li><li><a href=/How-To-Code-in-Go/docs/42-How_to_Distribute_Go_Modules/>42. 如何分发 Go 模块</a></li><li><a href=/How-To-Code-in-Go/docs/43-How_to_Use_a_Private_Go_Module_in_Your_Own_Project/ class=active>43. 如何在自己的项目中使用私有的Go模块</a></li></ul></li><li><p><strong>附录：资源</strong></p></li><li><p><a href=https://github.com/gocn/How-To-Code-in-Go><strong>Fork on Github</strong></a></p></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/How-To-Code-in-Go/svg/menu.svg class=book-icon alt=Menu></label>
<strong>43 How to Use a Private Go Module in Your Own Project</strong>
<label for=toc-control><img src=/How-To-Code-in-Go/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#前期准备>前期准备</a></li><li><a href=#分发一个私有模块>分发一个私有模块</a></li><li><a href=#配置-go-访问私有模块>配置 Go 访问私有模块</a></li><li><a href=#为-https-提供私有模块凭证>为 HTTPS 提供私有模块凭证</a></li><li><a href=#为ssh提供私有模块凭证>为SSH提供私有模块凭证</a></li><li><a href=#使用一个私有模块>使用一个私有模块</a></li><li><a href=#总结>总结</a></li></ul></nav></aside></header><article class=markdown><h1 id=如何在自己的项目中使用私有的go模块>如何在自己的项目中使用私有的Go模块
<a class=anchor href=#%e5%a6%82%e4%bd%95%e5%9c%a8%e8%87%aa%e5%b7%b1%e7%9a%84%e9%a1%b9%e7%9b%ae%e4%b8%ad%e4%bd%bf%e7%94%a8%e7%a7%81%e6%9c%89%e7%9a%84go%e6%a8%a1%e5%9d%97>#</a></h1><h2 id=简介>简介
<a class=anchor href=#%e7%ae%80%e4%bb%8b>#</a></h2><p>Go 的生态系统的一个优势是大量的模块是开源的。由于它们是开源的，所以可以自由访问、检查、使用和学习。然而，有时出于各种原因，有必要制作一个私有的 Go 模块，例如在公司内部保留专有的商业逻辑。</p><p>在本教程中，你将发布一个私有 Go 模块，设置访问私有模块的认证，并在项目中使用一个私有 Go 模块。</p><h2 id=前期准备>前期准备
<a class=anchor href=#%e5%89%8d%e6%9c%9f%e5%87%86%e5%a4%87>#</a></h2><ul><li>安装1.16 或更高版本的 Go。如何安装 Go ，请根据你的操作系统遵循 <a href=https://gocn.github.io/How-To-Code-in-Go/docs/01-How_To_Install_Go_and_Set_Up_a_Local-Programming_Environment_on_Ubuntu_18.04_DigitalOcean/>如何安装Go</a> 教程。</li><li>对分发 Go 模块的理解，可以在 <a href=https://www.digitalocean.com/community/tutorials/how-to-distribute-go-modules>如何分发 Go 模块</a> 教程中找到。</li><li>熟悉Git，你可以参考 <a href=https://www.digitalocean.com/community/cheatsheets/how-to-use-git-a-reference-guide>How To Use Git: A Reference Guide</a> 。</li><li>一个名为 <code>mysecret</code> 的空的 GitHub 私有仓库，用于发布你的私有模块。要开始使用，请遵循 <a href=https://docs.github.com/en/get-started/quickstart/create-a-repo>GitHub 创建仓库的文档</a>。</li><li>一个可以从你的仓库读取的<a href=https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token>GitHub 个人访问令牌</a>。你将用它来允许 Go 访问你的私有仓库。</li></ul><h2 id=分发一个私有模块>分发一个私有模块
<a class=anchor href=#%e5%88%86%e5%8f%91%e4%b8%80%e4%b8%aa%e7%a7%81%e6%9c%89%e6%a8%a1%e5%9d%97>#</a></h2><p>与许多编程语言不同，Go 从仓库而不是中央包服务器发布模块。这种方法的一个好处是，发布私有模块与发布公共模块非常相似。Go 的私有模块不需要一个完全独立的私有包服务器，而是通过一个私有源代码库发布。由于大多数源代码托管选项都支持开箱即用，所以不需要再建立一个额外的私有服务器。</p><p>为了使用私有模块，你需要访问一个私有 Go 模块。在本节中，你将创建并发布一个私有模块，你可以在以后的教程中使用，从另一个 Go 程序中访问一个私有模块。</p><p>要创建新的私有 Go 模块，首先要克隆它所在的私有 GitHub 仓库。作为先决条件的一部分，你在 GitHub 账户中创建了一个名为 <code>mysecret</code> 的私有空仓库，这就是你将用于私有模块的仓库。这个仓库可以在你的电脑上的任何地方克隆，但许多开发者倾向于为他们的项目建立一个目录。在本教程中，你将使用一个名为 <code>projects</code> 的目录。</p><p>创建 <code>projects</code> 目录并进入：</p><pre tabindex=0><code>mkdir projects
cd projects
</code></pre><p>在<code>projects</code>目录下，运行<code>git clone</code>将你的私人 <code>mysecret</code> 仓库克隆到你的电脑上：</p><pre tabindex=0><code>git clone git@github.com:your_github_username/mysecret.git
</code></pre><p>Git 会确认它已经克隆了你的模块，你可能会得到一个警告，说你克隆了一个空的仓库，但这并不值得担心：</p><pre tabindex=0><code>Output
Cloning into &#39;mysecret&#39;...
warning: You appear to have cloned an empty repository.
</code></pre><p>接下来，使用 <code>cd</code> 进入你克隆的 <code>mysecret</code> 目录，并使用 <code>go mod init</code> ，加上你的私有仓库的名称，创建一个新的Go模块：</p><pre tabindex=0><code>cd mysecret
go mod init github.com/your_github_username/mysecret
</code></pre><p>现在你的模块已经创建，现在是时候添加一个你可以从另一个项目中使用的函数了。使用 <code>nano</code>，或你喜欢的文本编辑器，打开一个与你的仓库同名的文件，如 <code>mysecret.go</code>。这个名字并不重要，可以是任何东西，但使用与仓库相同的名字可以使你在使用新模块时，更容易确定先看哪个文件。</p><pre tabindex=0><code>nano mysecret.go
</code></pre><p>在 <code>mysecret.go</code> 文件中，用与你的仓库相同的名字命名软件包，然后添加一个 <code>SecretProcess</code> 函数，在调用时打印 <code>Running the secret process!</code> 这一行：</p><p>projects/mysecret/mysecret.go</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>mysecret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>SecretProcess</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Running the secret process!&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在你已经创建了你的私人模块，你将把它发布到你的私人资源库，供其他人使用。由于你的私人资源库最初只允许你访问，你能够控制谁可以访问你的私人模块。你可能会限制自己的访问，但你也可以让朋友或同事访问。</p><p>由于私有和公共 Go 模块都是源码库，发布私有 Go 模块的过程与发布公共模块的过程相同。要发布你的新模块，使用<code>git add</code>命令在当前目录下进行修改，然后使用 <code>git commit</code> 命令将这些修改提交到你的本地存储库：</p><pre tabindex=0><code>git add .
git commit -m &#34;Initial private module implementation&#34;
</code></pre><p>你会看到 Git 确认你的初始提交已经成功，以及提交中包含的文件的摘要：</p><pre tabindex=0><code>Output
[main (root-commit) bda059d] Initial private module implementation
 2 files changed, 10 insertions(+)
 create mode 100644 go.mod
 create mode 100644 mysecret.go
</code></pre><p>现在唯一剩下的部分就是把你的改动移到你的 GitHub 仓库里。与公共模块类似，使用 <code>git push</code> 命令来发布你的代码：</p><pre tabindex=0><code>git push
</code></pre><p>然后，Git 会推送你的修改，让任何能访问你的私有仓库的人都能看到这些修改：</p><pre tabindex=0><code>git push origin main
Enumerating objects: 4, done.
Counting objects: 100% (4/4), done.
Delta compression using up to 8 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (4/4), 404 bytes | 404.00 KiB/s, done.
Total 4 (delta 0), reused 0 (delta 0), pack-reused 0
To github.com:your_github_username/mysecret.git
 * [new branch]      main -&gt; main
</code></pre><p>与公开的 Go 模块一样，你也可以为你的私有 Go 模块添加版本。<a href=https://www.digitalocean.com/community/tutorials/how-to-distribute-go-modules>如何发布Go模块</a>教程中的<a href=https://www.digitalocean.com/community/tutorials/how-to-distribute-go-modules#publishing-a-new-module-version>发布新模块版本</a>部分包含了如何做到这一点的信息。</p><p>在这一节中，你创建了一个带有 <code>SecretProcess</code> 函数的新模块，并将其发布到你的私人 <code>mysecret</code> GitHub 仓库，使其成为一个私人 Go 模块。为了从其他 Go 程序中访问这个模块，你需要配置 Go，使它知道如何访问这个模块。</p><h2 id=配置-go-访问私有模块>配置 Go 访问私有模块
<a class=anchor href=#%e9%85%8d%e7%bd%ae-go-%e8%ae%bf%e9%97%ae%e7%a7%81%e6%9c%89%e6%a8%a1%e5%9d%97>#</a></h2><p>虽然 Go 模块通常从其源代码库中分发，但 Go 团队也运行一些<a href=https://proxy.golang.org/>中央 Go 模块服务</a>，以确保模块在原始仓库发生意外时继续存在。默认情况下，Go 被配置为使用这些服务，但当你试图下载一个私有模块时，它们可能会引起问题，因为它们无法访问这些模块。要告诉 Go 某些导入路径是私有的，它不应该尝试使用中央 Go 服务，你可以使用 <code>GOPRIVATE</code> 环境变量。<code>GOPRIVATE</code> 环境变量是一个以逗号分隔的导入路径前缀列表，当遇到这种情况时，Go 工具将尝试直接访问它们，而不是通过中央服务。一个这样的例子是你刚刚创建的私有模块。</p><p>为了使用私有模块，你将通过在 <code>GOPRIVATE</code> 变量中设置来告诉 Go 哪个路径是私有的。在设置 <code>GOPRIVATE</code> 变量值时，你可以做几个选择。一个选择是将 <code>GOPRIVATE</code> 设置为 <code>github.com</code>。但这可能不是你想要的，因为这将告诉 Go 不为任何托管在<code>github.com</code>上的模块使用中央服务，包括不是你的模块。</p><p>下一个选择是将 <code>GOPRIVATE</code> 设置为只有你自己的用户路径，如<code>github.com/your_github_username</code>。这就解决了把所有 GitHub 视为私有的问题，但在某些时候，你可能会有你创建的公共模块，你想通过 Go 模块镜像下载。这样做不会造成任何问题，是一个完全合理的选择，但你也可以选择更具体的方式。</p><p>最具体的选择是将 <code>GOPRIVATE</code> 设置为与你的模块的路径完全匹配，例如，<code>github.com/your_github_username/mysecret</code> 。这就解决了前面两个选项的问题，但也带来了一个问题，即你需要将你的每个私有仓库单独添加到 <code>GOPRIVATE</code> 中，如图。</p><pre tabindex=0><code>GOPRIVATE=github.com/your_github_username/mysecret,github.com/your_github_username/othersecret
</code></pre><p>选择最适合你自己的方案是一个根据自身情况权衡利弊的问题。</p><p>由于你现在只有一个私有模块，我们将使用完整的仓库名称作为值。要在当前终端设置 <code>GOPRIVATE=github.com/your_github_username/mysecret</code> 环境变量，使用 export 命令：</p><pre tabindex=0><code>export GOPRIVATE=github.com/your_github_username/mysecret
</code></pre><p>如果你想仔细检查它是否被设置，你可以使用 <code>env</code> 命令和 <code>grep</code> 来检查 <code>GOPRIVATE</code> 名称：</p><pre tabindex=0><code>env | grep GOPRIVATE
</code></pre><pre tabindex=0><code>Output
GOPRIVATE=github.com/your_github_username/mysecret
</code></pre><p>尽管 Go 现在知道你的模块是私有的，但还不能完全使用该模块。如果你试图将你的私有模块 <code>go get</code> 到另一个模块中，你可能会看到一个类似的错误。</p><pre tabindex=0><code>go get github.com/your_github_username/mysecret
</code></pre><pre tabindex=0><code>Output
go get: module github.com/your_github_username/mysecret: git ls-remote -q origin in /Users/your_github_username/go/pkg/mod/cache/vcs/2f8c...b9ea: exit status 128:
fatal: could not read Username for &#39;https://github.com&#39;: terminal prompts disabled
Confirm the import path was entered correctly.
If this is a private repository, see https://golang.org/doc/faq#git_https for additional information.
</code></pre><p>这条错误信息说 Go 试图下载你的模块，但它遇到了它仍然无法访问的东西。由于 Git 被用来下载模块，它通常会要求你输入凭证。然而，在这种情况下，Go 正在为你调用 Git，无法提示你。在这一点上，要访问你的模块，你需要提供一种方法，让 Git 在不需要你立即输入的情况下检索你的凭证。</p><h2 id=为-https-提供私有模块凭证>为 HTTPS 提供私有模块凭证
<a class=anchor href=#%e4%b8%ba-https-%e6%8f%90%e4%be%9b%e7%a7%81%e6%9c%89%e6%a8%a1%e5%9d%97%e5%87%ad%e8%af%81>#</a></h2><p>告诉 Git 如何代表你登录的一种方法是 <code>.netrc</code> 文件。<code>.netrc</code> 文件位于用户的主目录中，包含了各种主机名称以及这些主机的登录凭证。它被许多工具广泛使用，包括 Git。</p><p>默认情况下，当 <code>go get</code> 试图下载一个模块时，它将首先尝试使用 HTTPS。然而，正如前面的例子所示，它无法提示你的用户名和密码。为了给 Git 提供你的凭证，你需要在你的主目录下有一个 <code>.netrc</code>，其中包括 <code>github.com</code>。</p><p>要在Linux、MacOS或 Windows Subsystem for Linux（WSL）上创建一个<code>.netrc</code>文件，在你的主目录（<code>~/</code>）中打开<code>.netrc</code>文件，这样你就可以编辑它：</p><pre tabindex=0><code>nano ~/.netrc
</code></pre><p>接下来，在该文件中创建一个新条目。<code>machine</code> 值应该是你要设置证书的主机名，本例中是 <code>github.com</code>。<code>login</code> 值应该是你的 GitHub用户名。最后，<code>password</code> 值应该是你创建的<a href=https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token>GitHub个人访问令牌</a>。</p><p>~/.netrc</p><pre tabindex=0><code>machine github.com
login your_github_username
password your_github_access_token
</code></pre><p>如果你愿意，你也可以把整个条目放在文件中的一行:</p><p>~/.netrc</p><pre tabindex=0><code>machine github.com login your_github_username password your_github_access_token
</code></pre><p>**注意：**如果你使用 <a href=https://bitbucket.org/>Bitbucket</a> 作为你的源代码托管，你可能还需要在 <code>bitbucket.org</code> 之外添加第二个条目 <code>api.bitbucket.org</code>。在过去，Bitbucket 为多种类型的版本控制提供托管服务，所以 Go 会在尝试下载之前使用 API 来检查仓库的类型。虽然现在已经不是这样了，但 API 检查仍然存在。如果你遇到这个问题，一个错误信息的例子可能是这样的：</p><pre tabindex=0><code>go get bitbucket.org/your_github_username/mysecret: reading https://api.bitbucket.org/2.0/repositories/your_bitbucket_username/protocol?fields=scm: 403 Forbidden
server response: Access denied. You must have write or admin access.
</code></pre><p>如果你在试图下载一个私有模块时看到 <code>403 Forbidden</code> 错误，请仔细检查 Go 试图连接的主机名。它可能表示另一个主机名，如 <code>api.bitbucket.org</code>，你需要添加到你的 <code>.netrc</code> 文件中。</p><p>现在你的环境被设置为使用 HTTPS 认证来下载你的私有模块。尽管 HTTPS 是 Go 和 Git 尝试下载模块的默认方式，但也可以告诉 Git 使用 SSH 来代替。使用 SSH 而不是 HTTPS 很有用，这样你就可以使用推送私有模块时使用的相同 SSH 密钥。如果你不愿意创建个人访问令牌，也可以在设置 <a href=https://www.digitalocean.com/community/tags/ci-cd>CI/CD</a> 环境时使用 <a href=https://docs.github.com/en/developers/overview/managing-deploy-keys>deploy keys</a>。</p><h2 id=为ssh提供私有模块凭证>为SSH提供私有模块凭证
<a class=anchor href=#%e4%b8%bassh%e6%8f%90%e4%be%9b%e7%a7%81%e6%9c%89%e6%a8%a1%e5%9d%97%e5%87%ad%e8%af%81>#</a></h2><p>为了使用 SSH 密钥作为私有 Go 模块的认证方式而不是 HTTPS，Git 提供了一个名为 <code>insteadOf</code> 的配置选项。<code>insteadOf</code> 选项表示你说：“与其”使用 <code>https://github.com/</code> 作为所有 Git 请求的 URL，你更愿意使用 <code>ssh://git@github.com/</code>。</p><p>在Linux、MacOS 和 WSL 上，这个配置存在于 <code>.gitconfig</code> 文件中。你可能已经很熟悉这个文件了，因为你的提交邮件地址和名字也是在这里配置的。要编辑该文件，请使用 <code>nano</code>，或你喜欢的文本编辑器，并打开你的主目录中的 <code>~/.gitconfig</code> 文件：</p><pre tabindex=0><code>nano ~/.gitconfig
</code></pre><p>一旦你打开这个文件，编辑它的 <code>url</code> 部分为 <code>ssh://git@github.com/</code> ，如下面的例子：</p><p>~/.gitconfig</p><pre tabindex=0><code>[user]
email = your_github_username@example.com
name = Sammy the Shark

[url &#34;ssh://git@github.com/&#34;]
insteadOf = https://github.com/
</code></pre><p><code>url</code> 部分相对于 <code>user</code> 部分的顺序并不重要，如果文件中除了你刚刚添加的 <code>url</code> 部分外没有其他内容，你也不需要担心。<code>email</code> 和 <code>name</code> 字段在 <code>user</code> 部分的顺序也不重要。</p><p>这个新的部分告诉 Git，你使用的任何以 <code>https://github.com/</code> 开头的 URL 应该用 <code>ssh://git@github.com/</code> 代替前缀。由于 Go 默认使用 HTTPS，这也会影响到你的 <code>go get</code> 命令。以你的私有模块为例，这意味着 Go 将 <code>github.com/your_github_username/mysecret</code> 导入路径变成 <code>https://github.com/your_github_username/mysecret</code> 的URL。当 Git 遇到这个 URL 时，它将看到这个 URL 与 <code>insteadOf</code> 引用的 <code>https://github.com/</code> 前缀相匹配，并将生成的 URL 变成 <code>ssh://git@github.com/your_github_username/mysecret</code>。</p><p>只要<code>ssh://git@</code>的 URL 对该主机也有效，这个模式也可以用于 GitHub 以外的域名。</p><p>在本节中，你通过更新 <code>.gitconfig</code> 文件并添加 <code>url</code> 部分，配置了 Git 使用 SSH 下载 Go 模块。现在你的私有模块的认证已经设置好了，你可以访问它，在你的Go程序中使用。</p><h2 id=使用一个私有模块>使用一个私有模块
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e4%b8%80%e4%b8%aa%e7%a7%81%e6%9c%89%e6%a8%a1%e5%9d%97>#</a></h2><p>在前面的章节中，您将 Go 配置为通过 HTTPS、SSH 或可能同时访问您的私有 Go 模块。现在 Go 可以访问你的私有模块，它的使用与你过去可能使用的任何公共模块相似。在本节中，你将创建一个使用你的私有模块的新 Go 模块。</p><p>在你用于项目的目录中，如 <code>projects</code>，用 <code>mkdir</code> 命令为新项目创建一个名为 <code>myproject</code> 的目录:</p><pre tabindex=0><code>mkdir myproject
</code></pre><p>一旦目录创建完毕，使用 <code>cd</code> 进入该目录，并根据你的项目所在的仓库 URL，使用 <code>go mod init</code> 为你的项目初始化一个新的 Go 模块，例如 <code>github.com/your_github_username/myproject</code>。如果你不打算将你的项目推送到任何其他仓库，模块名称可以是 <code>myproject</code>，或任何其他名称，但使用完整的 URL 是很好的做法，因为大多数共享的模块都需要它们。</p><pre tabindex=0><code>Output
go: creating new go.mod: module github.com/your_github_username/myproject
</code></pre><p>现在，用<code>nano</code>或你喜欢的文本编辑器打开<code>main.go</code>，创建你项目的第一个代码文件：</p><pre tabindex=0><code>nano main.go
</code></pre><p>在该文件中，设置初始的 <code>main</code> 函数，你将从该函数中调用你的私有模块：</p><p>projects/myproject/main.go</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;My new project!&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在运行你的项目确保一切都设置正确，你可以使用 <code>go run</code> 命令并向它提供 <code>main.go</code> 文件：</p><pre tabindex=0><code>go run main.go
</code></pre><pre tabindex=0><code>Output
My new project!
</code></pre><p>接下来，使用 <code>go get</code> 将你的私有模块作为你的新项目的一个依赖项加入，就像你对一个公共模块的做法一样：</p><pre tabindex=0><code>go get github.com/your_github_username/mysecret
</code></pre><p>然后 <code>go</code> 工具将下载你的私有模块的代码，并使用与你的最新提交哈希值和提交时间相匹配的版本字符串，将其添加为依赖关系：</p><pre tabindex=0><code>Output
go: downloading github.com/your_github_username/mysecret v0.0.0-20210920195630-bda059d63fa2
go get: added github.com/your_github_username/mysecret v0.0.0-20210920195630-bda059d63fa2
</code></pre><p>最后，再次打开 <code>main.go</code> 文件，更新代码，在 <code>main</code> 函数中添加对你的私有模块的 <code>SecretProcess</code> 函数的调用。你还需要更新 <code>import</code> 语句，把你的 <code>github.com/your_github_username/mysecret</code> 私有模块也作为一个导入文件。</p><p>projects/myproject/main.go</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/your_github_username/mysecret&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;My new project!&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mysecret</span>.<span style=color:#a6e22e>SecretProcess</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>要看到最终的项目与你的私有模块一起运行，再次使用 <code>go run</code> 命令，同时提供 <code>main.go</code> 文件作为参数：</p><pre tabindex=0><code>go run main.go
</code></pre><p>你会看到原始代码中的 <code>My new project!</code> 一行，但现在你也会看到你导入的 <code>mysecret</code> 模块中的 <code>Running the secret process!</code> 一行：</p><pre tabindex=0><code>Output
My new project!
Running the secret process!
</code></pre><p>在这一节中，你用 <code>go init</code> 创建了一个新的 Go 模块来访问你之前发布的私有模块。一旦你创建了这个模块，你就使用 <code>go get</code>来下载你的私有模块，就像你使用公共 Go 模块一样。最后，你使用 <code>go run</code> 来编译和运行使用私有模块的 Go 程序。</p><h2 id=总结>总结
<a class=anchor href=#%e6%80%bb%e7%bb%93>#</a></h2><p>在本教程中，你创建并发布了一个私有 Go 模块。你还设置了 HTTPS 和 SSH 认证来访问你的私有 Go 模块。最后，你在一个新项目中使用了你的私有模块。</p><p>关于 Go 模块的更多信息，Go 项目有<a href=https://blog.golang.org/using-go-modules>一系列博文</a>详细介绍了 Go 工具如何与模块互动和理解模块。Go 项目在<a href=https://golang.org/ref/mod>Go模块参考</a>中也有关于 Go 模块的非常详细的技术参考。</p><p>除了 <code>GOPRIVATE</code> 环境变量外，还有更多的变量可以在处理私有 Go 模块时使用。它们可以在<a href=https://golang.org/ref/mod>Go Modules Reference</a>的<a href=https://golang.org/ref/mod#private-modules>Private Modules</a>部分详细了解。</p><p>如果你有兴趣更详细地了解<code>.netrc</code> 文件，<a href=https://www.gnu.org/software/inetutils/manual/html_node/The-_002enetrc-file.html>GNU网站上的".netrc"</a> 包括一个所有可用关键字的列表。 <a href=https://git-scm.com/docs/git-config#Documentation/git-config.txt-urlltbasegtinsteadOf><code>git-config</code>文档</a>还包括更多关于你使用的 <code>insteadOf</code> 配置选项如何工作以及其他可用选项的信息。</p><p>本教程也是<a href=https://www.digitalocean.com/>DigitalOcean</a> <a href=https://www.digitalocean.com/community/tutorial_series/how-to-code-in-go>How to Code in Go</a>系列的一部分。该系列涵盖了许多 Go 的主题，从首次安装 Go 到如何使用语言本身。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#前期准备>前期准备</a></li><li><a href=#分发一个私有模块>分发一个私有模块</a></li><li><a href=#配置-go-访问私有模块>配置 Go 访问私有模块</a></li><li><a href=#为-https-提供私有模块凭证>为 HTTPS 提供私有模块凭证</a></li><li><a href=#为ssh提供私有模块凭证>为SSH提供私有模块凭证</a></li><li><a href=#使用一个私有模块>使用一个私有模块</a></li><li><a href=#总结>总结</a></li></ul></nav></div></aside></main></body></html>